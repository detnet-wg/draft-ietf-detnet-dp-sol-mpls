<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>DetNet MPLS Data Plane Encapsulation</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Terms used in this document">
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Abbreviations">
<link href="#rfc.section.3" rel="Chapter" title="3 Requirements language">
<link href="#rfc.section.4" rel="Chapter" title="4 MPLS DetNet data plane overview">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Layers of DetNet data plane">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 MPLS DetNet data plane scenarios">
<link href="#rfc.section.4.3" rel="Chapter" title="4.3 Packet flow example (service protection)">
<link href="#rfc.section.5" rel="Chapter" title="5 DetNet MPLS Data Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 End-system specific considerations">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 DetNet domain specific considerations">
<link href="#rfc.section.5.2.1" rel="Chapter" title="5.2.1 DetNet Layer Two Service">
<link href="#rfc.section.5.2.2" rel="Chapter" title="5.2.2 DetNet Routing Service (IP over MPLS)">
<link href="#rfc.section.5.3" rel="Chapter" title="5.3 DetNet Inter-Working Function (DN-IWF)">
<link href="#rfc.section.5.3.1" rel="Chapter" title="5.3.1 Networks with multiple technology segments">
<link href="#rfc.section.5.3.2" rel="Chapter" title="5.3.2 DN-IWF related considerations">
<link href="#rfc.section.6" rel="Chapter" title="6 MPLS-based DetNet data plane solution">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 DetNet over MPLS Encapsulation Components">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 MPLS data plane encapsulation">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 DetNet control word">
<link href="#rfc.section.6.4" rel="Chapter" title="6.4 Flow Identification">
<link href="#rfc.section.6.5" rel="Chapter" title="6.5 Indication of the DetNet Payload Type">
<link href="#rfc.section.6.6" rel="Chapter" title="6.6 OAM Indication">
<link href="#rfc.section.6.7" rel="Chapter" title="6.7 Flow Aggregation">
<link href="#rfc.section.6.7.1" rel="Chapter" title="6.7.1 Aggregation at the LSP">
<link href="#rfc.section.6.7.2" rel="Chapter" title="6.7.2 Aggregating DetNet flows as a new DetNet flow">
<link href="#rfc.section.6.7.3" rel="Chapter" title="6.7.3 Simple Aggregation at the DetNet layer">
<link href="#rfc.section.6.8" rel="Chapter" title="6.8 Service Layer Considerations">
<link href="#rfc.section.6.8.1" rel="Chapter" title="6.8.1 Edge node processing">
<link href="#rfc.section.6.8.2" rel="Chapter" title="6.8.2 Relay node processing">
<link href="#rfc.section.6.9" rel="Chapter" title="6.9 Other DetNet data plane considerations">
<link href="#rfc.section.6.9.1" rel="Chapter" title="6.9.1 Class of Service">
<link href="#rfc.section.6.9.2" rel="Chapter" title="6.9.2 Quality of Service">
<link href="#rfc.section.6.9.3" rel="Chapter" title="6.9.3 Cross-DetNet flow resource aggregation">
<link href="#rfc.section.6.9.4" rel="Chapter" title="6.9.4 Layer 2 addressing and QoS Considerations">
<link href="#rfc.section.6.9.5" rel="Chapter" title="6.9.5 Time Synchronization">
<link href="#rfc.section.7" rel="Chapter" title="7 Management and control considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 MPLS-based data plane">
<link href="#rfc.section.7.1.1" rel="Chapter" title="7.1.1 S-Label assignment and distribution">
<link href="#rfc.section.7.1.2" rel="Chapter" title="7.1.2 Explicit routes">
<link href="#rfc.section.7.2" rel="Chapter" title="7.2 Packet replication and elimination">
<link href="#rfc.section.7.3" rel="Chapter" title="7.3 Congestion protection and latency control">
<link href="#rfc.section.7.4" rel="Chapter" title="7.4 Bidirectional traffic">
<link href="#rfc.section.7.5" rel="Chapter" title="7.5 Flow aggregation control">
<link href="#rfc.section.8" rel="Chapter" title="8 DetNet IP Operation over DetNet MPLS Service">
<link href="#rfc.section.9" rel="Chapter" title="9 IEEE 802.1 TSN Interconnection over DetNet MPLS Service">
<link href="#rfc.section.10" rel="Chapter" title="10 DetNet MPLS Transport Layer Operation over IEEE 802.1 TSN Sub-Networks">
<link href="#rfc.section.10.1" rel="Chapter" title="10.1 Mapping of TSN Stream ID and Sequence Number">
<link href="#rfc.section.10.2" rel="Chapter" title="10.2 TSN Usage of FRER">
<link href="#rfc.section.10.3" rel="Chapter" title="10.3 Management and Control Implications">
<link href="#rfc.section.11" rel="Chapter" title="11 DetNet MPLS Transport Layer Operation over IP DetNet PSNs">
<link href="#rfc.section.12" rel="Chapter" title="12 Security considerations">
<link href="#rfc.section.13" rel="Chapter" title="13 IANA considerations">
<link href="#rfc.section.14" rel="Chapter" title="14 Contributors">
<link href="#rfc.section.15" rel="Chapter" title="15 Acknowledgements">
<link href="#rfc.references" rel="Chapter" title="16 References">
<link href="#rfc.references.1" rel="Chapter" title="16.1 Normative references">
<link href="#rfc.references.2" rel="Chapter" title="16.2 Informative references">
<link href="#rfc.appendix.A" rel="Chapter" title="A Example of DetNet data plane operation">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.9.6 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Korhonen, J., Ed. and B. Varga, Ed." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-ietf-detnet-dp-sol-mpls-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2018-22" />
  <meta name="dct.abstract" content="This document specifies Deterministic Networking data plane encapsulation solutions. The described data plane solutions is applied over an MPLS Packet Switched Networks.  " />
  <meta name="description" content="This document specifies Deterministic Networking data plane encapsulation solutions. The described data plane solutions is applied over an MPLS Packet Switched Networks.  " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">DetNet</td>
<td class="right">J. Korhonen, Ed.</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right"></td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">B. Varga, Ed.</td>
</tr>
<tr>
<td class="left">Expires: April 25, 2019</td>
<td class="right">Ericsson</td>
</tr>
<tr>
<td class="left"></td>
<td class="right">October 22, 2018</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">DetNet MPLS Data Plane Encapsulation<br />
  <span class="filename">draft-ietf-detnet-dp-sol-mpls-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This document specifies Deterministic Networking data plane encapsulation solutions. The described data plane solutions is applied over an MPLS Packet Switched Networks.  </p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on April 25, 2019.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2018 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Terms used in this document</a>
</li>
<li>2.2.   <a href="#rfc.section.2.2">Abbreviations</a>
</li>
</ul><li>3.   <a href="#rfc.section.3">Requirements language</a>
</li>
<li>4.   <a href="#rfc.section.4">MPLS DetNet data plane overview</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Layers of DetNet data plane</a>
</li>
<li>4.2.   <a href="#rfc.section.4.2">MPLS DetNet data plane scenarios</a>
</li>
<li>4.3.   <a href="#rfc.section.4.3">Packet flow example (service protection)</a>
</li>
</ul><li>5.   <a href="#rfc.section.5">DetNet MPLS Data Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">End-system specific considerations</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">DetNet domain specific considerations</a>
</li>
<ul><li>5.2.1.   <a href="#rfc.section.5.2.1">DetNet Layer Two Service</a>
</li>
<li>5.2.2.   <a href="#rfc.section.5.2.2">DetNet Routing Service (IP over MPLS)</a>
</li>
</ul><li>5.3.   <a href="#rfc.section.5.3">DetNet Inter-Working Function (DN-IWF)</a>
</li>
<ul><li>5.3.1.   <a href="#rfc.section.5.3.1">Networks with multiple technology segments</a>
</li>
<li>5.3.2.   <a href="#rfc.section.5.3.2">DN-IWF related considerations</a>
</li>
</ul></ul><li>6.   <a href="#rfc.section.6">MPLS-based DetNet data plane solution</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">DetNet over MPLS Encapsulation Components</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">MPLS data plane encapsulation</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">DetNet control word</a>
</li>
<li>6.4.   <a href="#rfc.section.6.4">Flow Identification</a>
</li>
<li>6.5.   <a href="#rfc.section.6.5">Indication of the DetNet Payload Type</a>
</li>
<li>6.6.   <a href="#rfc.section.6.6">OAM Indication</a>
</li>
<li>6.7.   <a href="#rfc.section.6.7">Flow Aggregation</a>
</li>
<ul><li>6.7.1.   <a href="#rfc.section.6.7.1">Aggregation at the LSP</a>
</li>
<li>6.7.2.   <a href="#rfc.section.6.7.2">Aggregating DetNet flows as a new DetNet flow</a>
</li>
<li>6.7.3.   <a href="#rfc.section.6.7.3">Simple Aggregation at the DetNet layer</a>
</li>
</ul><li>6.8.   <a href="#rfc.section.6.8">Service Layer Considerations</a>
</li>
<ul><li>6.8.1.   <a href="#rfc.section.6.8.1">Edge node processing</a>
</li>
<li>6.8.2.   <a href="#rfc.section.6.8.2">Relay node processing</a>
</li>
</ul><li>6.9.   <a href="#rfc.section.6.9">Other DetNet data plane considerations</a>
</li>
<ul><li>6.9.1.   <a href="#rfc.section.6.9.1">Class of Service</a>
</li>
<li>6.9.2.   <a href="#rfc.section.6.9.2">Quality of Service</a>
</li>
<li>6.9.3.   <a href="#rfc.section.6.9.3">Cross-DetNet flow resource aggregation</a>
</li>
<li>6.9.4.   <a href="#rfc.section.6.9.4">Layer 2 addressing and QoS Considerations</a>
</li>
<li>6.9.5.   <a href="#rfc.section.6.9.5">Time Synchronization</a>
</li>
</ul></ul><li>7.   <a href="#rfc.section.7">Management and control considerations</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">MPLS-based data plane</a>
</li>
<ul><li>7.1.1.   <a href="#rfc.section.7.1.1">S-Label assignment and distribution</a>
</li>
<li>7.1.2.   <a href="#rfc.section.7.1.2">Explicit routes</a>
</li>
</ul><li>7.2.   <a href="#rfc.section.7.2">Packet replication and elimination</a>
</li>
<li>7.3.   <a href="#rfc.section.7.3">Congestion protection and latency control</a>
</li>
<li>7.4.   <a href="#rfc.section.7.4">Bidirectional traffic</a>
</li>
<li>7.5.   <a href="#rfc.section.7.5">Flow aggregation control</a>
</li>
</ul><li>8.   <a href="#rfc.section.8">DetNet IP Operation over DetNet MPLS Service</a>
</li>
<li>9.   <a href="#rfc.section.9">IEEE 802.1 TSN Interconnection over DetNet MPLS Service</a>
</li>
<li>10.   <a href="#rfc.section.10">DetNet MPLS Transport Layer Operation over IEEE 802.1 TSN Sub-Networks</a>
</li>
<ul><li>10.1.   <a href="#rfc.section.10.1">Mapping of TSN Stream ID and Sequence Number</a>
</li>
<li>10.2.   <a href="#rfc.section.10.2">TSN Usage of FRER</a>
</li>
<li>10.3.   <a href="#rfc.section.10.3">Management and Control Implications</a>
</li>
</ul><li>11.   <a href="#rfc.section.11">DetNet MPLS Transport Layer Operation over IP DetNet PSNs</a>
</li>
<li>12.   <a href="#rfc.section.12">Security considerations</a>
</li>
<li>13.   <a href="#rfc.section.13">IANA considerations</a>
</li>
<li>14.   <a href="#rfc.section.14">Contributors</a>
</li>
<li>15.   <a href="#rfc.section.15">Acknowledgements</a>
</li>
<li>16.   <a href="#rfc.references">References</a>
</li>
<ul><li>16.1.   <a href="#rfc.references.1">Normative references</a>
</li>
<li>16.2.   <a href="#rfc.references.2">Informative references</a>
</li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Example of DetNet data plane operation</a>
</li>
<li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#sec_intro" id="sec_intro">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">Deterministic Networking (DetNet) is a service that can be offered by a network to DetNet flows.  DetNet provides these flows with a low packet loss rates and assured maximum end-to-end delivery latency.  General background and concepts of DetNet can be found in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>.  </p>
<p id="rfc.section.1.p.2">This document specifies the DetNet data plane and the on-wire encapsulation of DetNet flows over an MPLS-based Packet Switched Network (PSN). The specified encapsulation provides the building blocks to enable the DetNet service layer functions and allow flow identification as described in the DetNet Architecture.  </p>
<p id="rfc.section.1.p.3">The DetNet transport layer functionality that provides congestion protection for DetNet flows is assumed to be in place in a DetNet node.  </p>
<p id="rfc.section.1.p.4">Furthermore, this document also describes how DetNet flows are identified, and how a DetNet Relay/Edge/Transit nodes works. It also describes the function and operation of the Packet Replication (PRF) Packet Elimination (PEF) and Packet Ordering (POF) functions in the MPLS data plane.  </p>
<p id="rfc.section.1.p.5">This document does not define the associated control plane functions, or Operations, Administration, and Maintenance (OAM).  It also does not specify traffic handling capabilities required to deliver congestion protection and latency control for DetNet flows at the DetNet transport layer.  </p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> Terminology</h1>
<h1 id="rfc.section.2.1">
<a href="#rfc.section.2.1">2.1.</a> Terms used in this document</h1>
<p id="rfc.section.2.1.p.1">This document uses the terminology established in the DetNet architecture <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a> and the DetNet Data Plane Solution Alternatives <a href="#I-D.ietf-detnet-dp-alt" class="xref">[I-D.ietf-detnet-dp-alt]</a>.  </p>
<p></p>

<dl>
<dt>T-Label</dt>
<dd style="margin-left: 14">A label used to identify the LSP used to transport a DetNet flow across an MPLS PSN, e.g., a hop-by-hop label used between label switching routers (LSR).</dd>
<dt>S-Label</dt>
<dd style="margin-left: 14">A DetNet "service" label that is used between DetNet nodes that implement also the DetNet service layer functions. An S-Label is also used to identify a DetNet flow at DetNet service layer.</dd>
<dt>PEF</dt>
<dd style="margin-left: 14">A Packet Elimination Function (PEF) eliminates duplicate copies of packets received by an edge or a relay node to prevent excess packets flooding the network, or to prevent duplicate packets being sent out of the DetNet domain.  </dd>
<dt>PRF</dt>
<dd style="margin-left: 14">A Packet Replication Function (PRF) replicates DetNet flow packets and forwards them to one or more next hops in the DetNet domain.  The number of packet copies sent to each next hop is a DetNet flow specific parameter at the node doing the replication.  PRF can be implemented by an edge node, a relay node, or an end system.  </dd>
<dt>POF</dt>
<dd style="margin-left: 14">A Packet Ordering Function (POF) re-orders packets within a DetNet flow that are received out of order.  This function can be implemented by an edge node, a relay node, or an end system.  </dd>
<dt>PREOF</dt>
<dd style="margin-left: 14">Collective name for Packet Replication, Elimination, and Ordering Functions.  </dd>
<dt>d-CW</dt>
<dd style="margin-left: 14">A DetNet Control Word (d-CW) is used for sequencing and identifying duplicate packets of a DetNet flow at the DetNet service layer. </dd>
</dl>

<p> </p>
<h1 id="rfc.section.2.2">
<a href="#rfc.section.2.2">2.2.</a> Abbreviations</h1>
<p id="rfc.section.2.2.p.1">The following abbreviations used in this document: </p>

<dl>
<dt>AC</dt>
<dd style="margin-left: 14">Attachment Circuit.</dd>
<dt>CE</dt>
<dd style="margin-left: 14">Customer Edge equipment.</dd>
<dt>CoS</dt>
<dd style="margin-left: 14">Class of Service.</dd>
<dt>CW</dt>
<dd style="margin-left: 14">Control Word.</dd>
<dt>d-CW</dt>
<dd style="margin-left: 14">DetNet Control Word.</dd>
<dt>DetNet</dt>
<dd style="margin-left: 14">Deterministic Networking.</dd>
<dt>DF</dt>
<dd style="margin-left: 14">DetNet Flow.</dd>
<dt>DN-IWF</dt>
<dd style="margin-left: 14">DetNet Inter-Working Function.</dd>
<dt>L2</dt>
<dd style="margin-left: 14">Layer 2.</dd>
<dt>L2VPN</dt>
<dd style="margin-left: 14">Layer 2 Virtual Private Network.</dd>
<dt>L3</dt>
<dd style="margin-left: 14">Layer 3.</dd>
<dt>LSR</dt>
<dd style="margin-left: 14">Label Switching Router.</dd>
<dt>MPLS</dt>
<dd style="margin-left: 14">Multiprotocol Label Switching.</dd>
<dt>MPLS-TE</dt>
<dd style="margin-left: 14">Multiprotocol Label Switching - Traffic Engineering.</dd>
<dt>MPLS-TP</dt>
<dd style="margin-left: 14">Multiprotocol Label Switching - Transport Profile.</dd>
<dt>MS-PW</dt>
<dd style="margin-left: 14">Multi-Segment PseudoWire (MS-PW).</dd>
<dt>NSP</dt>
<dd style="margin-left: 14">Native Service Processing.</dd>
<dt>OAM</dt>
<dd style="margin-left: 14">Operations, Administration, and Maintenance.</dd>
<dt>PE</dt>
<dd style="margin-left: 14">Provider Edge.</dd>
<dt>PEF</dt>
<dd style="margin-left: 14">Packet Elimination Function.</dd>
<dt>PRF</dt>
<dd style="margin-left: 14">Packet Replication Function.</dd>
<dt>PREOF</dt>
<dd style="margin-left: 14">Packet Replication, Elimination and Ordering Functions.</dd>
<dt>POF</dt>
<dd style="margin-left: 14">Packet Ordering Function.</dd>
<dt>PSN</dt>
<dd style="margin-left: 14">Packet Switched Network.</dd>
<dt>PW</dt>
<dd style="margin-left: 14">PseudoWire.</dd>
<dt>QoS</dt>
<dd style="margin-left: 14">Quality of Service.</dd>
<dt>S-PE</dt>
<dd style="margin-left: 14">Switching Provider Edge.</dd>
<dt>T-PE</dt>
<dd style="margin-left: 14">Terminating Provider Edge.</dd>
<dt>TSN</dt>
<dd style="margin-left: 14">Time-Sensitive Network.</dd>
</dl>

<p> </p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> Requirements language</h1>
<p id="rfc.section.3.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 <a href="#RFC2119" class="xref">[RFC2119]</a> <a href="#RFC8174" class="xref">[RFC8174]</a> when, and only when, they appear in all capitals, as shown here.  </p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#sec_dt_dp" id="sec_dt_dp">MPLS DetNet data plane overview</a>
</h1>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#sec_lay_dt_dp" id="sec_lay_dt_dp">Layers of DetNet data plane</a>
</h1>
<p id="rfc.section.4.1.p.1">This document describes how DetNet flows are carried over MPLS networks. The DetNet Architecture, <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>, decomposes the DetNet data plane into two layers: a service layer and a transport layer.  The basic approach defined in this document supports the DetNet service layer based on existing pseudowire (PW) encapsulations and mechanisms, and supports the DetNet transport layer based on existing MPLS Traffic Engineering encapsulations and mechanisms.  Background on PWs can be found in <a href="#RFC3985" class="xref">[RFC3985]</a> and <a href="#RFC3031" class="xref">[RFC3031]</a>.  </p>
<div id="rfc.figure.1"></div>
<div id="dn_mpls_dp_approach"></div>
<pre>
  DetNet        MPLS
    .
    .
+-----------+
|  Service  | d-CW, S-Label
+-----------+
| Transport | T-Label(s)
+-----------+
    .
    .
</pre>
<p class="figure">Figure 1: DetNet adaptation to MPLS data plane</p>
<p id="rfc.section.4.1.p.2">The MPLS DetNet data plane approach defined in this document is shown in <a href="#dn_mpls_dp_approach" class="xref">Figure 1</a>.  The service layer is supported by a DetNet control word (d-CW) which conforms to the Generic PW MPLS Control Word (PWMCW) defined in <a href="#RFC4385" class="xref">[RFC4385]</a>.  A d-CW identifying service label (S-Label) is also used. The transport layer is supported by one or labels (T-Labels).  </p>
<p id="rfc.section.4.1.p.3">A node operating on a DetNet flow in the Detnet layer, i.e. a node processing a DetNet packet which has the S-label as top of stack uses the local context associated with that S-label to determine what local operation(s) are applied to that packet. The S-label has to be unique on each edge and relay node, which is achieved by using a label taken from the platform label space <a href="#RFC3031" class="xref">[RFC3031]</a>.  </p>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#sec_mpls_dt_dp_scen" id="sec_mpls_dt_dp_scen">MPLS DetNet data plane scenarios</a>
</h1>
<div id="rfc.figure.2"></div>
<div id="fig_tsn_mpls_detnet"></div>
<pre>
TSN             Edge          Transit         Edge         TSN
End System      Node            Node          Node         End System
                (T-PE)         (LSR)          (T-PE)

+---------+   +.........+                   +.........+   +---------+
|  Appl.  |&lt;--:Svc Proxy:--End to End Svc.--:Svc Proxy:--&gt;|  Appl.  |
+---------+   +---------+                   +---------+   +---------+
|   TSN   |   |TSN| |Svc|&lt;-- DetNet flow --&gt;: Service :--&gt;|   TSN   |
+---------+   +---+ +---+    +---------+    +---------+   +---------+
|Transport|   |Trp| |Trp|    |Transport|    |Trp| |Trp|   |Transport|
+-------.-+   +--.+ +-.-+    +--.----.-+    +-.-+ +-.-+   +---.-----+
        :  Link  :    /  ,-----.  \   :  Link  :    /  ,-----.  \
        +........+    +-[  Sub  ]-+   +........+    +-[  Sub  ]-+
                        [Network]                     [Network] 
                         `-----'                       `-----'

        |&lt;- TSN -&gt;|   |&lt;----- DetNet MPLS ----&gt;|    |&lt;-- TSN ---&gt;|
</pre>
<p class="figure">Figure 2: A TSN over DetNet MPLS Enabled Network</p>
<p><a href="#fig_tsn_mpls_detnet" class="xref">Figure 2</a> shows several node types defined in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>.  DetNet Edge Nodes sit at the boundary of a DetNet domain. They are responsible for mapping non-DetNet aware traffic to DetNet services.  They also support the imposition and disposition of the required DetNet encapsulation.  These are functionally similar to pseudowire (PW) Terminating Provider Edge (T-PE) nodes which use MPLS-TE LSPs.  </p>
<p id="rfc.section.4.2.p.2">Native TSN flow and DetNet MPLS flow differ not only by the additional MPLS specific encapsulation, but DetNet MPLS flows have on each DetNet node an associated DetNet specific data structure, what defines flow related characteristics and required forwarding functions. Edge Nodes MUST provide a Service Proxy entity that "associates" the DetNet flows and native flows at the edge of the DetNet domain. It ensures that the DN Flow is properly served at the Edge node (and inside the domain).  </p>
<p id="rfc.section.4.2.p.3">Transit nodes are normal MPLS Label Switching Routers (LSRs).  They are generally unaware of the special requirements of DetNet flows, although they need to provide traffic engineering services and proper QoS to the LSPs associated with DetNet flows to enhance the prospect of the LSPs meeting the DetNet service requirements. Some implementations of transit nodes may be DetNet aware, but such nodes just support the DetNet transport layer.  </p>
<p id="rfc.section.4.2.p.4">The MPLS LSP may be provided by any MPLS method (provisioned, RSVP-TE, MPLS- TP, or MPLS Segment Routing (SR)).  </p>
<div id="rfc.figure.3"></div>
<div id="fig_ip_mpls_detnet"></div>
<pre>
IP  DetNet       Relay          Transit       Relay       IP DetNet
End System       Node            Node         Node        End System
                 (T-PE)          (LSR)        (T-PE)
+---------+                                               +---------+
|  Appl.  |&lt;--------------- End to End Service ----------&gt;|  Appl.  |
+---------+    .....-----+                  +-----.....   +---------+
| Service |&lt;---: Service |-- DetNet flow ---| Service :--&gt;| Service |
+---------+    +---------+   +---------+    +---------+   +---------+
|Transport|    |Trp| |Trp|   |Transport|    |Trp| |Trp|   |Transport|
+-------.-+    +-.-+ +-.-+   +---.---.-+    +-.-+ +-.-+   +---.-----+
        :  Link  :    /  ,-----.  \  :  Link  :    /  ,-----.  \
        +........+    +-[  Sub  ]-+  +........+    +-[  Sub  ]-+
                        [Network]                    [Network]
                         `-----'                      `-----'

        |&lt;-DN IP-&gt;|   |&lt;---- DetNet MPLS ----&gt;|      |&lt;-DN IP-&gt;|
        </pre>
<p class="figure">Figure 3: DetNet (DN) IP Over MPLS Network</p>
<p><a href="#fig_ip_mpls_detnet" class="xref">Figure 3</a> and <a href="#fig_8021_detnet" class="xref">Figure 4</a>, show different cases where relay nodes may be used.  Relay nodes are similar to edge nodes in that both are aware of the needs of particular DetNet flows and take care to process them in accordance with the required performance needs.  They differ in that relay nodes sit within a DetNet domain while edge nodes always sit at DetNet domain boundaries.  Both node types can enhance the reliability of delivery by enabling the replication of packets so that multiple copies, possibly over multiple paths are forwarded through the DetNet domain.  They also reduce the impact of replication by eliminating surplus copies of DetNet packets.  Relay nodes may sit the boundary of an MPLS domain when the non-MPLS domain is DetNet aware. Relay nodes are functionally similar to PW S-PEs or, when at the edge of an MPLS network, T-PEs <a href="#RFC6073" class="xref">[RFC6073]</a>.  </p>
<p><a href="#fig_8021_detnet" class="xref">Figure 4</a> illustrates how DetNet can provide services for IEEE 802.1TSN end systems, CE1 and CE2, over a DetNet enabled network.  The edge nodes, E1 and E2, insert and remove required DetNet data plane encapsulation.  The 'X' in the edge nodes and relay node, R1, represent a potential DetNet flow packet replication and elimination point.  This conceptually parallels L2VPN services, and could leverage existing related solutions as discussed below.  </p>
<div id="rfc.figure.4"></div>
<div id="fig_8021_detnet"></div>
<pre>
     TSN    |&lt;------- End to End DetNet Service ------&gt;|  TSN
    Service |         Transit          Transit         | Service
TSN  (AC)   |        |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|        |  (AC)  TSN
End    |    V        V    1  V        V   2   V        V   |    End
System |    +--------+       +--------+       +--------+   |  System
+---+  |    |   E1   |=======|   R1   |=======|   E2   |   |   +---+
|   |--|----|._X_....|..DF1..|.._ _...|..DF3..|...._X_.|---|---|   |
|CE1|  |    |    \   |       |   X    |       |   /    |   |   |CE2|
|   |       |     \_.|..DF2..|._/ \_..|..DF4..|._/     |       |   |
+---+       |        |=======|        |=======|        |       +---+
    ^       +--------+       +--------+       +--------+       ^
    |        Edge Node       Relay Node        Edge Node       |
    |          (T-PE)           (S-PE)          (T-PE)         |
    |                                                          |
    |&lt;-TSN-&gt;  &lt;------- TSN Over DetNet MPLS ---------&gt;  &lt;-TSN-&gt;|
    |                                                          |
    |&lt;--- Emulated Time Sensitive Networking (TSN) Service ---&gt;|

    DFx = DetNet Flow x

</pre>
<p class="figure">Figure 4: IEEE 802.1TSN over DetNet</p>
<p id="rfc.section.4.2.p.7">[Editor's note: TSN Over DetNet MPLS arrows extended beyond the 'X' (the PREF points).] </p>
<p><a href="#fig_pw_detnet" class="xref">Figure 5</a> illustrates how an end to end MPLS-based DetNet service is provided in a more detail.  In this case, the end systems, CE1 and CE2, are able to send and receive DetNet flows, and R1 and R2 are relay nodes as they sit in the middle of a DetNet network.  For example, an end system sends data encapsulated in MPLS.  The 'X' in the end systems, and relay nodes represents potential DetNet flow packet replication and elimination points.  In this figure, the relay nodes may change the underlying transport, for example tunneling MPLS over IP <a href="#detnet-data-plane-encapsulation-for-ip-transport-networks" class="xref">Section 11</a>, or simply interconnect network segments.  </p>
<div id="rfc.figure.5"></div>
<div id="fig_pw_detnet"></div>
<pre>
      DetNet                                           DetNet
MPLS  Service          Transit          Transit       Service MPLS
DetNet  |             |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|            | DetNet
End     |             V   1   V        V   2   V            | End
System  |    +--------+       +--------+       +--------+   | System
+---+   |    |   R1   |=======|   R2   |=======|   R3   |   |  +---+
|  X...DFa...|._X_....|..DF1..|.__ ___.|..DF3..|...._X_.|.DFa..|.X |
|CE1|========|    \   |       |   X    |       |   /    |======|CE2|
|   |   |    |     \_.|..DF2..|._/ \__.|..DF4..|._/     |   |  |   |
+---+        |        |=======|        |=======|        |      +---+
    ^        +--------+       +--------+       +--------+      ^
    |        Relay Node       Relay Node       Relay Node      |
    |          (S-PE)           (S-PE)           (S-PE)        |
    |                                                          |
    |&lt;---------------------- DetNet MPLS ---------------------&gt;|
    |                                                          |
    |&lt;--------------- End to End DetNet Service --------------&gt;|
</pre>
<p class="figure">Figure 5: MPLS-Based Native DetNet</p>
<p><a href="#fig_pw_detnet2" class="xref">Figure 6</a> illustrates how an end to end MPLS-based DetNet service is provided where the end systems are not able to send and receive DetNet flows. In this example, the nodes labeled CE1 and CE2 could be non-DetNet aware IP routers or hosts. Note that E1 and E2 are edge nodes as they sit boundaries of the DetNet enabled domain.  </p>
<div id="rfc.figure.6"></div>
<div id="fig_pw_detnet2"></div>
<pre>
      IP                                              IP
Non   Service          Transit          Transit       Service Non
DetNet                |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|              DetNet
End     |             V   1   V        V   2   V            | End
System  |    +--------+       +--------+       +--------+   | System
+---+   |    |   E1   |=======|   R2   |=======|   E3   |   |  +---+
|   |--------|._X_....|..DF1..|.__ ___.|..DF3..|...._X_.|------|   |
|CE1|   |    |    \   |       |   X    |       |   /    |   |  |CE2|
|   |   |    |     \_.|..DF2..|._/ \__.|..DF4..|._/     |   |  |   |
+---+        |        |=======|        |=======|        |      +---+
             +--------+       +--------+       +--------+       
             ^ Edge Node      Relay Node       Edge Node^
             | (T-PE)           (S-PE)          (T-PE)  |
             |                                          |
     &lt;--IP--&gt;| &lt;-------- IP Over DetNet MPLS ---------&gt; |&lt;--IP--&gt;
             |                                          |
             |&lt;------ End to End DetNet Service -------&gt;|
</pre>
<p class="figure">Figure 6: MPLS-Based DetNet (non-MPLS End System)</p>
<p><a href="#fig_ip_pw_detnet" class="xref">Figure 7</a> illustrates how end to end DetNet service is provided where the end systems are able to send and receive IP DetNet flows, e.g., per <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>, and the MPLS  nodes optionally provide service protection. In this case R1 and R3 are T-PEs and R2 is an S-PE and the DetNet service is end-to-end.  </p>
<div id="rfc.figure.7"></div>
<div id="fig_ip_pw_detnet"></div>
<pre>
      DetNet                                         DetNet
IP    Service         Transit          Transit       Service  IP
DetNet               |&lt;-Tnl-&gt;|        |&lt;-Tnl-&gt;|               DetNet
End     |            V   1   V        V   2   V            |  End
System  |   +--------+       +--------+       +--------+   |  System
+---+   |   |   R1   |=======|   R2   |=======|   R3   |   |   +---+
|   |-------|._X_....|..DF1..|.__ ___.|..DF3..|...._X_.|-------|   |
|CE1|   |   |    \   |       |   X    |       |   /    |   |   |CE2|
|   |   |   |     \_.|..DF2..|._/ \__.|..DF4..|._/     |   |   |   |
+---+       |        |=======|        |=======|        |       +---+
    ^       +--------+       +--------+       +--------+       ^
    |        Relay Node       Relay Node       Relay Node      |
    |          (T-PE)           (S-PE)          (T-PE)         |
    |                                                          |
    |&lt;-DN IP-&gt; &lt;-------- DetNet MPLS ---------------&gt; &lt;-DN IP-&gt;|
    |                                                          |
    |&lt;-------------- End to End DetNet Service ---------------&gt;|
</pre>
<p class="figure">Figure 7: DetNet IP over DetNet (DN) MPLS</p>
<h1 id="rfc.section.4.3">
<a href="#rfc.section.4.3">4.3.</a> Packet flow example (service protection)</h1>
<p id="rfc.section.4.3.p.1">An example MPLS DetNet network fragment and packet flow is illustrated in <a href="#fig_mpls_example" class="xref">Figure 8</a>.  </p>
<div id="rfc.figure.8"></div>
<div id="fig_mpls_example"></div>
<pre>
   1      1.1       1.1      1.2.1    1.2.1      1.2.2
CE1----EN1--------R1-------R2-------R3--------EN2-----CE2
         \           1.2.1 /                   /
          \1.2     /-----+                   /
           +------R4------------------------+
                     1.2.2 
 </pre>
<p class="figure">Figure 8: Example Packet flow in DetNet Enabled MPLS Network</p>
<p id="rfc.section.4.3.p.2">In <a href="#fig_mpls_example" class="xref">Figure 8</a> the numbers are used to identify the instance of a packet. Packet 1 is the original packet, and packets 1.1, and 1.2 are two first generation copies of packet 1.  Packet 1.2.1 is a second generation copy of packet 1.2 etc.  Note that these numbers never appear in the packet, and are not to be confused with sequence numbers, labels or any other identifier that appears in the packet. They simply indicate the generation number of the original packet so that its passage through the network fragment can be identified to the reader.  </p>
<p id="rfc.section.4.3.p.3">Customer Equipment CE1 sends a packet into the DetNet enabled MPLS network. This is packet (1).  Edge Node EN1 encapsulates the packet as a DetNet Packet and sends it to Relay node R1 (packet 1.1).  EN1 makes a copy of the packet (1.2), encapsulates it and sends this copy to Relay node R4.  </p>
<p id="rfc.section.4.3.p.4">Note that along the MPLS path from EN1 to R1 there may be zero or more LSRs which, for clarity, are not shown. The same is true for any other path between two DetNet entities shown in <a href="#fig_mpls_example" class="xref">Figure 8</a>.  </p>
<p id="rfc.section.4.3.p.5">Relay node R4 has been configured to send one copy of the packet to Relay Node R2 (packet 1.2.1) and one copy to Edge Node EN2 (packet 1.2.2).  </p>
<p id="rfc.section.4.3.p.6">R2 receives packet copy 1.2.1 before packet copy 1.1 arrives, and, having been configured to perform packet elimination on this DetNet flow, forwards packet 1.2.1 to Relay Node R3.  Packet copy 1.1 is of no further use and so is discarded by R2.  </p>
<p id="rfc.section.4.3.p.7">Edge Node EN2 receives packet copy 1.2.2 from R4 before it receives packet copy 1.2.1 from R2 via relay Node R3. EN2 therefore strips any DetNet encapsulation from packet copy 1.2.2 and forwards the packet to CE2. When EN2 receives the later packet copy 1.2.1 this is discarded.  </p>
<p id="rfc.section.4.3.p.8">The above is of course illustrative of many network scenarios that can be configured.  Between a pair of relay nodes there may be one or more transport nodes that simply forward the DetNet traffic, but these are omitted for clarity.  </p>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#dn-gen-encap-solution" id="dn-gen-encap-solution">DetNet MPLS Data Considerations</a>
</h1>
<p id="rfc.section.5.p.1">This section provides informative considerations related to providing DetNet service to flows which are identified based on their header information. At a high level, the following are provided on a per flow basis: </p>

<dl>
<dt>Congestion protection and latency control:</dt>
<dd style="margin-left: 8">
<br><br> Usage of allocated resources (queuing, policing, shaping) to ensure that the congestion-related loss and latency/jitter requirements of a DetNet flow are met.  </dd>
<dt>Explicit routes:</dt>
<dd style="margin-left: 8">
<br><br> Use of a specific path for a flow.  This limits miss-ordering and latency.  </dd>
<dt>Service protection:</dt>
<dd style="margin-left: 8">
<br><br> Which in the case of this document primarily relates to replication and elimination. Changing the explicit path after a failure is detected in order to restore delivery of the required DetNet service characteristics is also possible. Path changes, even in the case of failure recovery, can lead to the out of order delivery of data.  </dd>
<dt>Load sharing:</dt>
<dd style="margin-left: 8">
<br><br> Generally, distributing packets of the same DetNet flow over multiple paths is not recommended. Such load sharing, e.g., via ECMP or UCMP, impacts ordering and end-to-end jitter.  </dd>
<dt>Troubleshooting:</dt>
<dd style="margin-left: 8">
<br><br> For example, to support identification of misbehaving flows.  </dd>
<dt>Recognize flow(s) for analytics:</dt>
<dd style="margin-left: 8">
<br><br> For example, increase counters.  </dd>
<dt>Correlate events with flows:</dt>
<dd style="margin-left: 8">
<br><br> For example, unexpected loss.  </dd>
</dl>

<p> </p>
<p id="rfc.section.5.p.2">The DetNet data plane also allows for the aggregation of DetNet flows, e.g., via MPLS hierarchical LSPs, to improved scaling.  When DetNet flows are aggregated, transit nodes may have limited ability to provide service on per-flow DetNet identifiers. Therefore, identifying each individual DetNet flow on a transit node may not be achieved in some network scenarios, but DetNet service can still be assured in these scenarios through resource allocation and control.  </p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> End-system specific considerations</h1>
<p id="rfc.section.5.1.p.1">Data-flows requiring DetNet service are generated and terminated on end-systems. Encapsulation depends on application and its preferences. In a DetNet (or even a TSN) domain the DN (TSN) functions use at most two flow parameters, namely Flow-ID and Sequence Number. However, an application may exchange further flow related parameters (e.g., time-stamp), which are not considered by DN functions.  </p>
<p id="rfc.section.5.1.p.2">Two types of end-systems are distinguished: </p>

<ul>
<li>L2 (Ethernet) end-system: application directly over L2.</li>
<li>L3 (IP) end-system: application over L3.</li>
</ul>

<p> </p>
<p id="rfc.section.5.1.p.3">Note: An MPLS DetNet end system (as shown in <a href="#fig_pw_detnet" class="xref">Figure 5</a>) can be treated as a combination of an L3 (IP) end-system and an MPLS DetNet edge node.  </p>
<p id="rfc.section.5.1.p.4">In case of Ethernet end-systems the application data is encapsulated directly in L2. From the DN domain perspective no upper layer protocols are visible.  The Data-flow uses only Ethernet tag(s) and further flow specific parameters (if needed) are hidden inside the protocol data unit (PDU).  </p>
<p id="rfc.section.5.1.p.5">The IP end-system scenario is different. In this case, data-flows are encapsulated directly in IP and, typically, other higher layer protocols such as UDP and Real-time Transport Protocol (RTP).  Many valid combinations exist and it is up to applications to select specific headers to be used. Details on support for DetNet IP data flows can be found in <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>.  </p>
<p id="rfc.section.5.1.p.6">As a general rule, DetNet domains MUST be capable of forwarding any Data-flows and the DetNet domain MUST NOT mandate the end-system encapsulation format.  </p>
<p id="rfc.section.5.1.p.7">Furthermore, no application-level-proxy function is envisioned inside the DetNet domain, so end-systems peer with end-systems using the same application encapsulation format (see figure below): </p>

<ul>
<li>L2 end-systems peer with L2 end-systems and </li>
<li>L3 end-systems peer with L3 end-systems.</li>
</ul>

<p> </p>
<div id="rfc.figure.9"></div>
<div id="fig_es_connect"></div>
<pre>
+-----+
|  X  |                               +-----+
+-----+                               |  X  |
| Eth |               ________        +-----+
+-----+     _____    /        \       | Eth |
       \   /     \__/          \___   +-----+
        \ /                        \ /
         0======== tunnel-1 ========0_
         |                             \
          \                             |
          0========= tunnel-2 =========0
         / \                        __/ \
  +-----+   \__     DetNet domain  /     \
  |  X  |      \         __       /       +-----+
  +-----+       \_______/  \_____/        |  X  |
  |  IP |                                 +-----+
  +-----+                                 |  IP |
                                          +-----+
  
    </pre>
<p class="figure">Figure 9: End-systems and the DetNet domain</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> DetNet domain specific considerations</h1>
<p id="rfc.section.5.2.p.1">From a connection type perspective, three scenarios are distinguished: </p>

<ol>
<li>Directly attached: end-system is directly connected to an edge node.  </li>
<li>Indirectly attached: end-system is behind a (L2-TSN / L3-DetNet) sub-network.  </li>
<li>DN integrated: end-system is part of the DetNet domain.  </li>
</ol>

<p> </p>
<p id="rfc.section.5.2.p.2">L3 end-systems may use any of these connection types, however L2 end-systems may use only the first two (directly or indirectly attached). DetNet domain MUST allow communication between any end-systems of the same type (L2-L2, L3-L3), independent of their connection type and DetNet capability. However directly attached and indirectly attached end-systems have no knowledge about the DetNet domain and its encapsulation format at all. See <a href="#fig_es_con_types" class="xref">Figure 10</a> for L3 end-system scenarios.  </p>
<div id="rfc.figure.10"></div>
<div id="fig_es_con_types"></div>
<pre>
                                   ____+----+
           +----+        _____    /    | ES3|
           | ES1|____   /     \__/     +----+___
           +----+    \ /                        \
                      +                          | 
              ____     \                        _/ 
+----+     __/    \     +__    DetNet domain   /
| ES2|____/  L2/L3 |___/   \         __     __/
+----+    \_______/         \_______/  \___/

  
    </pre>
<p class="figure">Figure 10: Connection types of L3 end-systems</p>
<h1 id="rfc.section.5.2.1">
<a href="#rfc.section.5.2.1">5.2.1.</a> DetNet Layer Two Service</h1>
<p id="rfc.section.5.2.1.p.1">The simplest DetNet service is to provide tunneling for layer two, where the connected hosts are in the same broadcast (BC) domain. Forwarding over the DetNet domain is based on L2 (MAC) addresses (i.e. dst-MAC), or on received interface <a href="#RFC3985" class="xref">[RFC3985]</a>. In both cases the L2 headers MUST either be kept, or provision must be made for their reconstruction at egress from the DetNet domain.  </p>
<div id="rfc.figure.11"></div>
<div id="fig_encap_DN_bridging"></div>
<pre>
                     +------+
                     |  X   |
            +------+ +------+
            |  X   | |  IP  |
            +------+ +------+
End-system  |  L2  | |  L2  |
      +-----+======+-+======+--+------+
DetNet tunnel                  | Shim |
                               +------+ 
                               | MPLS |
                               +------+
                               |  L2  |
                               +------+

Examples:

                      +------+  +------+
                      |  X   |  |  X   |
            +------+  +------+  +------+
            |  X   |  |  IP  |  |  IP  | 
            +------+  +------+  +------+
            |  L2  |  |  L2  |  |  L2  |
      +-----+======+--+======+--+======+-----+
            | d-CW |  | d-CW |  | d-CW |
            +------+  +------+  +------+
            | MPLS |  | MPLS |  | MPLS |
            +------+  +------+  +------+
            |  L2  |  |  L2  |  | UDP  |  
            +------+  +------+  +------+
                                |  IP  |
                                +------+
                                |  L2  |
                                +------+
  
    </pre>
<p class="figure">Figure 11: Encapsulation format for DetNet Layer Two Service</p>
<p id="rfc.section.5.2.1.p.2">As shown in <a href="#fig_encap_DN_bridging" class="xref">Figure 11</a> both L2 and L3 end-systems can be served by such a DetNet L2  encapsulation service.  This encapsulation service may be carried over MPLS natively  <a href="#pwSolution" class="xref">Section 6.2</a>, or over MPLS over IP <a href="#detnet-data-plane-encapsulation-for-ip-transport-networks" class="xref">Section 11</a>.  </p>
<h1 id="rfc.section.5.2.2">
<a href="#rfc.section.5.2.2">5.2.2.</a> <a href="#detrouting" id="detrouting">DetNet Routing Service (IP over MPLS)</a>
</h1>
<p id="rfc.section.5.2.2.p.1">IP traffic and IP DetNet flows, see <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>, can be carried over a DetNet MPLS domain.  In such cases, the IP headers are modified per standard router behavior, e.g., TTL handling. <a href="#fig_mpls_DN_routing" class="xref">Figure 12</a> shows the encapsulation of an IP flow over MPLS as well as when MPLS is carried over an IP PSN, see <a href="#detnet-data-plane-encapsulation-for-ip-transport-networks" class="xref">Section 11</a>.  </p>
<div id="rfc.figure.12"></div>
<div id="fig_mpls_DN_routing"></div>
<pre>
            
            
            +------+
            |  X   |
            +------+
End-system  |  IP  |
      +-----+======+--+------+
DetNet tunnel         | Shim |
                      +------+ 
                      | MPLS |
                      +------+
                      |  L2  |
                      +------+

Examples:

            +------+  +------+
            |  X   |  |  X   |
            +------+  +------+
            |  IP  |  |  IP  | 
      +-----+======+--+======+-----+
            | d-CW |  | d-CW |
            +------+  +------+
            | MPLS |  | MPLS |
            +------+  +------+
            |  L2  |  | UDP  |  
            +------+  +------+
                      |  IP  |
                      +------+
                      |  L2  |
                      +------+
  
  </pre>
<p class="figure">Figure 12: Encapsulation format for DetNet Routing in MPLS PSN for L3 end-systems</p>
<h1 id="rfc.section.5.3">
<a href="#rfc.section.5.3">5.3.</a> DetNet Inter-Working Function (DN-IWF)</h1>
<h1 id="rfc.section.5.3.1">
<a href="#rfc.section.5.3.1">5.3.1.</a> <a href="#nwsegments" id="nwsegments">Networks with multiple technology segments</a>
</h1>
<p id="rfc.section.5.3.1.p.1">There are networking scenarios, where the DetNet domain contains multiple technology segments (IP, MPLS, ..) and all those segments are under the same administrative control (see <a href="#fig_pref_xcrs_segments" class="xref">Figure 13</a>). Furthermore, DetNet nodes may be interconnected via TSN segments.  </p>
<p id="rfc.section.5.3.1.p.2">An important aspect of DetNet network design is the placement of DetNet functions across the domain. Designs based on segment-by-segment optimization can provide only sub-optimal solutions. In order to achieve global optimized Inter-Working Functions (DN-IWF) can be placed at segment edge nodes, which stitch together DetNet flows across connected segments.    </p>
<p id="rfc.section.5.3.1.p.3">DN-IWF may ensure that flow attributes are correlated across segment edges. For example, there are two DetNet functions which require Sequence Numbers: (1) PEF: removes duplications from flows and (2) POF: ensures in-order-delivery of packet in a flow. Stitching flows together and correlating attributes means for example that replication of packets can happen in one segment and elimination of duplicates in a different one.   </p>
<div id="rfc.figure.13"></div>
<div id="fig_pref_xcrs_segments"></div>
<pre>
                                   ______   
                         ____     /      \__ 
            ____        /     \__/          \___   ______
+----+   __/    +======+                       +==+      \     +----+
|src |__/  Seg1  )     |                       |  \  Seg3 \____| dst|
+----+  \_______+      \       Segment-2       |   \+_____/    +----+
                 \======+_                    _+===/
                          \         __     __/
                           \_______/  \___/


                                       +------------+
             +---------------E----+    |            |
+----+       |               |    +----R---+        |          +----+
|src |-------R           +---+             |        E----------+ dst|
+----+       |           |                 E--------+          +----+
             +-----------R                 |
                         +-----------------+
  
    </pre>
<p class="figure">Figure 13: Optimal replication and elimination placement across technology segments example</p>
<h1 id="rfc.section.5.3.2">
<a href="#rfc.section.5.3.2">5.3.2.</a> DN-IWF related considerations</h1>
<p id="rfc.section.5.3.2.p.1">The goal of DN-IWF is to (1) match and (2) translate segment specific flow attributes. The DN-IWF ensures that segment specific attributes comprise per domain unique attributes for the whole DetNet domain. This characteristic can ensure that DetNet functions can be based on per domain attributes and not per segment attributes.  </p>
<p id="rfc.section.5.3.2.p.2">The two DetNet specific attributes have the following characteristics: </p>

<ul>
<li>Flow-ID: it is same in all packets of a flow </li>
<li>Sequence Number: it is different packet-by-packet </li>
</ul>

<p> </p>
<p id="rfc.section.5.3.2.p.3">For the Flow-ID the DN-IWF can implement a static mapping. The situation is more complicated for Sequence Number as it is different packet-by-packet, so it may need more sophisticated translation unless its format is exactly the same in the two technology segments. In this later case the DN-IWF can simple copy the Sequence Number field between the tunneling encapsulation of the two technology segments.  </p>
<p id="rfc.section.5.3.2.p.4">In case of three technology segments (IP, MPLS and TSN) three DN-IWF functions can be specified. In the rest of this section the focus is on the (1) IP - MPLS network scenario. Note: the use-cases are out-of-scope for (2) TSN - IP, (3) TSN - MPLS.  </p>
<p id="rfc.section.5.3.2.p.5">Simplest implementation of DN-IWF is provided if the flow attributes have the same format. Such a common denominator of the tunnel encapsulation format is the pseudowire encapsulation over both IP and MPLS.  </p>
<div id="rfc.figure.14"></div>
<div id="fig_pwox_enc"></div>
<pre>
   +--------+
   |        |
   | X    X |
   |  ____  |
   | /    \ |
   |        |
   |/\/\/\/\|

      Oops!
 404 Not Found
  
    </pre>
<p class="figure">Figure 14: FIGURE Placeholder PW over X</p>
<p id="rfc.section.5.3.2.p.6">[Editor's note: Where is the text describing how 802.1 TSN Streams are mapping to DetNet services/flows. i.e., EVPN+] </p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#dn-dt-solution" id="dn-dt-solution">MPLS-based DetNet data plane solution</a>
</h1>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#dn-MPLS-en-comps" id="dn-MPLS-en-comps">DetNet over MPLS Encapsulation Components</a>
</h1>
<p id="rfc.section.6.1.p.1">To carry DetNet over MPLS the following is required: </p>

<ol>
<li>A method of identifying the MPLS payload type.</li>
<li>A method of identifying the DetNet flow group to the processing element.</li>
<li>A method of distinguishing DetNet OAM packets from DetNet data packets.</li>
<li>A method of carrying the DetNet sequence number.</li>
<li>A suitable LSP to deliver the packet to the egress PE.</li>
<li>A method of carrying queuing and forwarding indication.</li>
</ol>

<p> </p>
<p id="rfc.section.6.1.p.2">In this design an MPLS service label (the S-Label), similar to a pseudowire (PW) label <a href="#RFC3985" class="xref">[RFC3985]</a>, is used to identify both the DetNet flow identity and the payload MPLS payload type satisfying (1) and (2) in the list above.  OAM traffic discrimination happens through the use of the Associated Channel method described in <a href="#RFC4385" class="xref">[RFC4385]</a>.  The sequence number is carried in the DetNet Control word which carries the Data/OAM discriminator.  The LSP used to transport the DetNet packet may be of any type (MPLS-LDP, MPLS-TE, MPLS-TP <a href="#RFC5921" class="xref">[RFC5921]</a>, or MPLS-SR <a href="#I-D.ietf-spring-segment-routing-mpls" class="xref">[I-D.ietf-spring-segment-routing-mpls]</a>).  The LSP (T-Label) label and/or the S-Label may be used to indicate the queue processing as well as the forwarding parameters.  </p>
<p id="rfc.section.6.1.p.3">To simplify implementation and to maximize interoperability two sequence number sizes are supported: a 16 bit sequence number and a 28 bit sequence number.  The 16 bit sequence number is needed to support some types of legacy clients. The 28 bit sequence number is used in situations where it is necessary ensure that in high speed networks the sequence number space does not wrap whilst packets are in flight. In addition it must be possible to send a packet with a zero length sequence number, to support the case where sequence numbers are not required by a particular DetNet flow.  </p>
<p id="rfc.section.6.1.p.4">Note that the concept of a zero length sequence number is not to be confused with a sequence number of zero. For example, were the sequence number size is 16 bits, the sequence will contain: 65535, 0, 1. In this case zero is an ordinary sequence number. Unlike <a href="#RFC4448" class="xref">[RFC4448]</a> a sequence number of zero does not indicate that no sequence number is in use. Where sequence numbers are not in use, and thus a zero length sequence number is in used, the sequence number field in the packet is sent as zero. The DetNet packet forwarder knows which of these cases applies through configuration parameters associated with each specific DetNet flow.  </p>
<p id="rfc.section.6.1.p.5">Note that when the network consists only of DetNet enabled nodes with no aggregation, Penultimate Hop Popping (PHP) means that the only label in the label stack may be the S-label.  </p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#pwSolution" id="pwSolution">MPLS data plane encapsulation</a>
</h1>
<p><a href="#fig_pw_mpls" class="xref">Figure 15</a> illustrates a DetNet data plane MPLS encapsulation.  The MPLS-based encapsulation of the DetNet flows is a good fit for the Layer-2 interconnect deployment cases (see <a href="#fig_8021_detnet" class="xref">Figure 4</a>).  Furthermore, end to end DetNet service i.e., native DetNet deployment (see <a href="#fig_pw_detnet" class="xref">Figure 5</a>) is also possible if DetNet end systems are capable of initiating and termination MPLS encapsulated packets.  </p>
<p id="rfc.section.6.2.p.2">The MPLS-based DetNet data plane encapsulation consists of: </p>

<ul>
<li>DetNet control word (d-CW) containing sequencing information for packet replication and duplicate elimination purposes, and the OAM indicator. There MUST be a separate sequence number space for each DetNet flow.</li>
<li>DetNet service Label (S-label) that identifies a DetNet flow to the peer node that is to process it.  The S-Label is allocated from the platform label space <a href="#RFC3031" class="xref">[RFC3031]</a>.  </li>
<li>Zero or more MPLS transport LSP label(s) (T-label) used to direct the packet along the label switched path (LSP) to the next peer node along the path.  When Penultimate Hop Popping is in use there may be no label T-label in the protocol stack on the final hop.  </li>
<li>The necessary data-link encapsulation is then applied prior to transmission over the physical media.  </li>
</ul>

<p> </p>
<div id="rfc.figure.15"></div>
<div id="fig_pw_mpls"></div>
<pre>
  DetNet MPLS-based encapsulation
                         
+---------------------------------+
|                                 |
|           DetNet Flow           |
|         Payload  Packet         |
|                                 |
+---------------------------------+ &lt;--\
|       DetNet Control Word       |    |
+---------------------------------+    +--&gt; DetNet data plane
|           S-Label               |    |    MPLS encapsulation 
+---------------------------------+ &lt;--/
|           T-Label(s)            |
+---------------------------------+
|           Data-Link             |
+---------------------------------+
|           Physical              |
+---------------------------------+

    </pre>
<p class="figure">Figure 15: Encapsulation of a DetNet flow in an MPLS(-TP) PSN</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> DetNet control word</h1>
<p id="rfc.section.6.3.p.1">A DetNet control word (d-CW) conforms to the Generic PW MPLS Control Word (PWMCW) defined in <a href="#RFC4385" class="xref">[RFC4385]</a> and is illustrated in  <a href="#fig_detnet_cw" class="xref">Figure 16</a>.  The upper nibble of the d-CW MUST be set to zero (0). Two  sequence number sizes are supported: 16 bits and 28 bits. The sequence number size in use for the d-CW associated with a DetNet flow (S-Label) is configured either by a control plane or manually for each DetNet flow. The sequence number is aligned to the right (least significant bits) and unused bits MUST be set to zero (0).  Each DetNet flow MUST have its own sequence number counter. The sequence number is incremented by one for each new packet.  </p>
<p id="rfc.section.6.3.p.2">As discussed in <a href="#dn-dt-solution" class="xref">Section 6</a>, zero is an ordinary sequence number with no special meaning. Also as discussed therein, where no sequence number is used by a particular DetNet flow, the sequence number field in the d-CW is set to zero.  </p>
<p id="rfc.section.6.3.p.3">The d-CW MUST always be present in a packet. In a case where the sequence number is not used (e.g., for DetNet-t-flows) a zero length sequence number is used and the sequence number MUST be set to zero (0).  </p>
<div id="rfc.figure.16"></div>
<div id="fig_detnet_cw"></div>
<pre>
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|0 0 0 0|                Sequence Number                        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

    </pre>
<p class="figure">Figure 16: DetNet Control Word</p>
<h1 id="rfc.section.6.4">
<a href="#rfc.section.6.4">6.4.</a> Flow Identification</h1>
<p id="rfc.section.6.4.p.1">DetNet flow identification at a DetNet service layer is realized by an S-label.  The S-label is allocated from the platform label space <a href="#RFC3031" class="xref">[RFC3031]</a> which means that the DetNet flow is correctly identified and matched to the flow parameters, including the flow history, regardless of which input interface the packet arrives on.  The S-label MUST be at the bottom label of the label stack for a DetNet-s- or DetNet-st-flow and MUST precede the d-CW.  </p>
<p id="rfc.section.6.4.p.2">The S-label for a specific DetNet flow is unique to that DetNet flow on a specific node, but is not required to be identical with the S-label for that DetNet flow in any other node within the DetNet domain. Thus the S-label can only be used to identify the DetNet flow at the intended receiving node.  </p>
<h1 id="rfc.section.6.5">
<a href="#rfc.section.6.5">6.5.</a> <a href="#PTI-section" id="PTI-section">Indication of the DetNet Payload Type</a>
</h1>
<p id="rfc.section.6.5.p.1">The only nodes that needs to know the payload type of a flow are the DetNet ingress node and the DetNet egress nodes.  The ingress node has to know how to process the packet it receives from the ingress AC or IP flow, and the egress edge node has to know how to prepare the packet for transmission to the next hop.  </p>
<p id="rfc.section.6.5.p.2">On ingress a DetNet edge node has to classify the packets into those that are for transmission as Detnet packets and those that are for transmission as "normal" packets at one of more lower priorities.  The packet type is indicated to the egress edge node through the value of the S-label.  Thus, when the egress edge node looks up the S-label one of the parameters returned is the packet type which in turn tells the egress edge node how to prepare the packet for transmission to a next hop.  </p>
<p id="rfc.section.6.5.p.3">The consequence of this approach is that if multiple packet encapsulations are processed on a node pair, each encapsulation will need its own S-Label.  That is not generally a problems, since it is anticipated that only one encapsulation type will be present for each DetNet flow.  Of course, if for some reason the multiple encapsulations are needed to support a single DetNet service, multiple S-labels will be required for that service.  Note that in the unlikely case that Ipv4 and IPv6 will map to the same DetNet flow, different S-labels will be needed to differentiate between the versions of IP.  </p>
<h1 id="rfc.section.6.6">
<a href="#rfc.section.6.6">6.6.</a> <a href="#oam-indication" id="oam-indication">OAM Indication</a>
</h1>
<p id="rfc.section.6.6.p.1">OAM follows the procedures set out in <a href="#RFC5085" class="xref">[RFC5085]</a> with the restriction that only Virtual Circuit Connectivity Verification (VCCV) type 1 is supported.</p>
<p id="rfc.section.6.6.p.2">As shown in Figure 3 of <a href="#RFC5085" class="xref">[RFC5085]</a> when the first nibble of the d-CW is 0x0 the payload following the d-CW is normal user data. However, when the first nibble of the d-CW is 0X1, the payload that follows the d-DW is an OAM payload with the OAM type indicated by the value in the d-CW Channel Type field.</p>
<p id="rfc.section.6.6.p.3">The reader is referred to <a href="#RFC5085" class="xref">[RFC5085]</a> for a more detailed description of the Associated Channel mechanism, and to the DetNet work on OAM for more information DetNet OAM.  </p>
<h1 id="rfc.section.6.7">
<a href="#rfc.section.6.7">6.7.</a> <a href="#FAG" id="FAG">Flow Aggregation</a>
</h1>
<p></p>

<ol>
<li>Aggregate at the LSP (Transport)</li>
<li>Aggregating DetNet flows as a new DetNet flow</li>
<li>Simple Aggregation at the DetNet layer</li>
</ol>

<p> </p>
<p id="rfc.section.6.7.p.2">A further method of using SR to perform aggregation is for further study.  </p>
<p id="rfc.section.6.7.p.3">The resource control and management aspects of aggregation (including the queuing/shaping/ policing implications) will be covered in other documents.  </p>
<p id="rfc.section.6.7.p.4">The ability to aggregate individual flows, and their associated resource control, into a larger aggregate is an important technique for improving scaling of control in the data, management and control planes.  The DetNet data plane allows for the aggregation of DetNet flows, to improved scaling. There are three methods of introducing flow aggregation: </p>
<p id="rfc.section.6.7.p.5">The following review comments were received when this section was committed to github.  </p>
<p id="rfc.section.6.7.p.6">General comment: We should points to the major issue of aggregation, namely the Seq.Num related problem. The aggregated flows have their own Seq.Num and those are independent. We should consider to group the aggregation techniques as per their impact on what DetNet functions they allow on a DetNet flow. (E.g., aggregation without new Aggregate.Seq.Num would prohibit usage of FR, EF and in-order-delivery function on the aggregate flow).  </p>
<p id="rfc.section.6.7.p.7">SR based aggregation can be treated as a form of H-LSP aggregation.  Should we differentiate them? What are the differences? </p>
<p id="rfc.section.6.7.p.8">What are the issues when aggregating of different payload types? Should we add an editor note on this? </p>
<p id="rfc.section.6.7.p.9">Simple-aggregation-at-the-detnet-layer: is this not the same as H-LSP? The A-label can be treated just as an additional T-label.  </p>
<p id="rfc.section.6.7.p.10">End of review comment.  </p>
<h1 id="rfc.section.6.7.1">
<a href="#rfc.section.6.7.1">6.7.1.</a> <a href="#aggregation-at-the-lsp" id="aggregation-at-the-lsp">Aggregation at the LSP</a>
</h1>
<p id="rfc.section.6.7.1.p.1">DetNet flows transported via MPLS can leverage MPLS-TE?s existing support for hierarchical LSPs (H-LSPs), see <a href="#RFC4206" class="xref">[RFC4206]</a>.  H-LSPs are typically used to aggregate control and resources, they may also be used to provide OAM or protection for the aggregated LSPs.  Arbitrary levels of aggregation naturally falls out of the definition for hierarchy and the MPLS label stack <a href="#RFC3032" class="xref">[RFC3032]</a>.  DetNet nodes which support aggregation (LSP hierarchy) map one or more LSPs (labels) into and from an H-LSP.  Both carried LSPs and H-LSPs may or may not use the TC field, i.e., L-LSPs or E-LSPs.  Such nodes will need to ensure that traffic from aggregated LSPs are placed (shaped/policed/ enqueued) onto the H-LSPs in a fashion that ensures the required DetNet service is preserved.  </p>
<p id="rfc.section.6.7.1.p.2">Additional details of the traffic control capabilities needed at a DetNet-aware node may be covered in the new service descriptions mentioned above or in separate future documents.  Management and control plane mechanisms will also need to ensure that the service required on the aggregate flow (H-LSP or DSCP) are provided, which may include the discarding or remarking mentioned in the previous sections.  </p>
<h1 id="rfc.section.6.7.2">
<a href="#rfc.section.6.7.2">6.7.2.</a> <a href="#aggregating-detnet-flows-as-a-new-detnet-flow" id="aggregating-detnet-flows-as-a-new-detnet-flow">Aggregating DetNet flows as a new DetNet flow</a>
</h1>
<p id="rfc.section.6.7.2.p.1">An aggregate can be built by layering DetNet flows as shown below: </p>
<pre>
+---------------------------------+
|                                 |
|           DetNet Flow           |
|         Payload  Packet         |
|                                 |
+---------------------------------+ &lt;--\
|       DetNet Control Word       |    |
+=================================+    |
|            S-Label              |    |    
+---------------------------------+    +----DetNet data plane
|       DetNet Control Word       |    |    MPLS encapsulation
+=================================+    |
|            A-Label              |    |
+---------------------------------+ &lt;--/
|           T-Label(s)            |
+---------------------------------+
|           Data-Link             |
+---------------------------------+
|           Physical              |
+---------------------------------+
</pre>
<p id="rfc.section.6.7.2.p.2">Both the Aggregation (A) label and the S-label have their MPLS S bit set indicating bottom of stack, and the d-CW allows the PREOF to work.  </p>
<p id="rfc.section.6.7.2.p.3">It is a property of the A-label that what follows is d-CW followed by an S-label. A relay node processing the A-label would not know the underlying payload type. This would only be known to a node that was a peer of the node imposing the S-label. However there is no real need for it to know the payload type during aggregation processing.  </p>
<h1 id="rfc.section.6.7.3">
<a href="#rfc.section.6.7.3">6.7.3.</a> <a href="#simple-aggregation-at-the-detnet-layer" id="simple-aggregation-at-the-detnet-layer">Simple Aggregation at the DetNet layer</a>
</h1>
<p id="rfc.section.6.7.3.p.1">Another approach would be not to include a d-CW for the aggregated flow.  This would be functionally similar to aggregation at the transport layer using H-LSPs, but would confine knowledge of the aggregation to the DetNet layer. Such an approach shares the disadvantage that PREOF operations would not be possible. OAM operation in this mode is for further study.  </p>
<pre>
 +---------------------------------+
 |                                 |
 |           DetNet Flow           |
 |         Payload  Packet         |
 |                                 |
 +---------------------------------+ &lt;--\
 |       DetNet Control Word       |    |
 +=================================+    |
 |            S-Label              |    +----DetNet data plane    
 +---------------------------------+    |    MPLS encapsulation
 |            A-Label              |    |
 +---------------------------------+ &lt;--/
 |           T-Label(s)            |
 +---------------------------------+
 |           Data-Link             |
 +---------------------------------+
 |           Physical              |
 +---------------------------------+
</pre>
<h1 id="rfc.section.6.8">
<a href="#rfc.section.6.8">6.8.</a> Service Layer Considerations</h1>
<p id="rfc.section.6.8.p.1">The edge and relay node internal procedures related to PREOF are implementation specific.  The order of a packet elimination or replication is out of scope in this specification.  However, care should be taken that the replication function does not actually loopback packets as "replicas".  Looped back packets include artificial delay when the node that originally initiated the packet receives it again. Also, looped back packets may make the network condition to look healthier than it actually is (in some cases link failures are not reflected properly because looped back packets make the situation appear better than it actually is).  </p>
<p id="rfc.section.6.8.p.2">It is important that the DetNet layer is configured such that a DetNet node never receives its own replicated packets. If it were to receive such packets the replication function would make the loop more destructive of bandwidth than a conventional unicast loop.  Ultimately the TTL in the S-Label will cause the packet to die during a transient, but given the sensitivity of applications to packet latency the impact on the  DetNet application would be severe.  </p>
<h1 id="rfc.section.6.8.1">
<a href="#rfc.section.6.8.1">6.8.1.</a> <a href="#sec_t_pe" id="sec_t_pe">Edge node processing</a>
</h1>
<p id="rfc.section.6.8.1.p.1">An edge node is resposable for matching ingress packets to the service they require and encapsulating them accordingly.An edge node may participate in the packet replication and duplication elimination.  </p>
<p id="rfc.section.6.8.1.p.2">The DetNet-aware forwarder selects the egress DetNet member flow segment based on the flow identification.  The mapping of ingress DetNet member flow segment to egress DetNet member flow segment may be statically or dynamically configured. Additionally the DetNet-aware forwarder does duplicate frame elimination based on the flow identification and the sequence number combination. The packet replication is also done within the DetNet-aware forwarder. During elimination and the replication process the sequence number of the DetNet member flow MUST be preserved and copied to the egress DetNet member flow.  </p>
<p id="rfc.section.6.8.1.p.3">The internal design of a relay node is out of scope of this document. However the reader's attention is drawn to the need to make any PREOF state available to the packet processor(s) dealing with packets to which the PREOF functions must be applied, and to maintain that state is such as way that it is available to the packet processor operation on the next packet in the DetNet flow (which may be a duplicate, a late packet, or the next packet in sequence.  </p>
<p id="rfc.section.6.8.1.p.4">[Editor's note: I think the rest of this section belongs in a new "802.1 TSN (island Interconnect) over MPLS DetNet" section.] </p>
<p id="rfc.section.6.8.1.p.5">This may be done in the DetNet layer, or where the native service processing (NSP) <a href="#RFC3985" class="xref">[RFC3985]</a> is IEEE 802.1CB <a href="#IEEE8021CB" class="xref">[IEEE8021CB]</a> capable, the packet replication and duplicate elimination MAY entirely be done in the NSP, bypassing the DetNet flow encapsulation and logic entirely. This enables operating over unmodified implementations and deployments. The NSP approach works only between edge nodes and cannot make use of relay nodes.  </p>
<p id="rfc.section.6.8.1.p.6">The NSP approach is useful end to end tunnel and for for "island interconnect" scenarios. However, when there is a need to do PREOF in a middle of the network, such plain edge to edge operation is not sufficient.  </p>
<p id="rfc.section.6.8.1.p.7">The extended forwarder MAY copy the sequencing information from the native DetNet packet into the DetNet sequence number field and vice versa. If there is no existing sequencing information available in the native packet or the forwarder chose not to copy it from the native packet, then the extended forwarder MUST maintain a sequence number counter for each DetNet flow (indexed by the DetNet flow identification).  </p>
<h1 id="rfc.section.6.8.2">
<a href="#rfc.section.6.8.2">6.8.2.</a> <a href="#sec_s_pe" id="sec_s_pe">Relay node processing</a>
</h1>
<p id="rfc.section.6.8.2.p.1">A DetNet Relay node operates in the DetNet transport layer . This processing is done within an extended forwarder function. Whether an ingress DetNet member flow receives DetNet specific processing depends on how the forwarding is programmed.  Some relay nodes may be DetNet service aware, while others may be unmodified LSRs that only understand how to swicth MPLS-TE LSPs.  </p>
<p id="rfc.section.6.8.2.p.2">It is also possible to treat the relay node as a transit node, see <a href="#Aggregation" class="xref">Section 6.9.3</a>.  Again, this is entirely up to how the forwarding has been programmed.  </p>
<h1 id="rfc.section.6.9">
<a href="#rfc.section.6.9">6.9.</a> Other DetNet data plane considerations</h1>
<h1 id="rfc.section.6.9.1">
<a href="#rfc.section.6.9.1">6.9.1.</a> Class of Service</h1>
<p id="rfc.section.6.9.1.p.1">[Editor's note: this section needs to updated to discuss how DetNet service is mapped to E- and L-LSPs.  Perhaps this gets merged with the aggregation section or dropped?] </p>
<p id="rfc.section.6.9.1.p.2">Class and quality of service, i.e., CoS and QoS, are terms that are often used interchangeably and confused with each other. In the context of DetNet, CoS is used to refer to mechanisms that provide traffic forwarding treatment based on aggregate group basis and QoS is used to refer to mechanisms that provide traffic forwarding treatment based on a specific DetNet flow basis.  Examples of existing network level CoS mechanisms include DiffServ which is enabled by IP header differentiated services code point (DSCP) field <a href="#RFC2474" class="xref">[RFC2474]</a> and MPLS label traffic class field <a href="#RFC5462" class="xref">[RFC5462]</a>, and at Layer-2, by IEEE 802.1p priority code point (PCP).  </p>
<p id="rfc.section.6.9.1.p.3">CoS for DetNet flows carried in PWs and MPLS is provided using the existing MPLS Differentiated Services (DiffServ) architecture <a href="#RFC3270" class="xref">[RFC3270]</a>.  Both E-LSP and L-LSP MPLS DiffServ modes MAY be used to support DetNet flows.  The Traffic Class field (formerly the EXP field) of an MPLS label follows the definition of <a href="#RFC5462" class="xref">[RFC5462]</a> and <a href="#RFC3270" class="xref">[RFC3270]</a>.  The Uniform, Pipe, and Short Pipe DiffServ tunneling and TTL processing models are described in <a href="#RFC3270" class="xref">[RFC3270]</a> and <a href="#RFC3443" class="xref">[RFC3443]</a> and MAY be used for MPLS LSPs supporting DetNet flows. MPLS ECN MAY also be used as defined in ECN <a href="#RFC5129" class="xref">[RFC5129]</a> and updated by <a href="#RFC5462" class="xref">[RFC5462]</a>.  </p>
<p id="rfc.section.6.9.1.p.4">CoS for DetNet flows carried in IPv6 is provided using the standard differentiated services code point (DSCP) field <a href="#RFC2474" class="xref">[RFC2474]</a> and related mechanisms.  The 2-bit explicit congestion notification (ECN) <a href="#RFC3168" class="xref">[RFC3168]</a> field MAY also be used.  </p>
<p id="rfc.section.6.9.1.p.5">One additional consideration for DetNet nodes which support CoS services is that they MUST ensure that the CoS service classes do not impact the congestion protection and latency control mechanisms used to provide DetNet QoS.  This requirement is similar to requirement for MPLS LSRs to that CoS LSPs do not impact the resources allocated to TE LSPs via <a href="#RFC3473" class="xref">[RFC3473]</a>.  </p>
<h1 id="rfc.section.6.9.2">
<a href="#rfc.section.6.9.2">6.9.2.</a> Quality of Service</h1>
<p id="rfc.section.6.9.2.p.1">Quality of Service (QoS) mechanisms for flow specific traffic treatment typically includes a guarantee/agreement for the service, and allocation of resources to support the service.  Example QoS mechanisms include discrete resource allocation, admission control, flow identification and isolation, and sometimes path control, traffic protection, shaping, policing and remarking. Example protocols that support QoS control include <a href="#RFC2205" class="xref">Resource ReSerVation Protocol (RSVP)</a> (RSVP) and RSVP-TE <a href="#RFC3209" class="xref">[RFC3209]</a> and <a href="#RFC3473" class="xref">[RFC3473]</a>.  The existing MPLS mechanisms defined to support CoS <a href="#RFC3270" class="xref">[RFC3270]</a> can also be used to reserve resources for specific traffic classes.  </p>
<p id="rfc.section.6.9.2.p.2">In addition to explicit routes, and packet replication and elimination, described in <a href="#dn-dt-solution" class="xref">Section 6</a> above, DetNet provides zero congestion loss and bounded latency and jitter.  As described in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a>, there are different mechanisms that maybe used separately or in combination to deliver a zero congestion loss service.  These mechanisms are provided by the either the MPLS or IP layers, and may be combined with the mechanisms defined by the underlying network layer such as 802.1TSN.  </p>
<p id="rfc.section.6.9.2.p.3">A baseline set of QoS capabilities for DetNet flows carried in PWs and MPLS can provided by MPLS with Traffic Engineering (MPLS-TE) <a href="#RFC3209" class="xref">[RFC3209]</a> and <a href="#RFC3473" class="xref">[RFC3473]</a>.  TE LSPs can also support explicit routes (path pinning).  Current service definitions for packet TE LSPs can be found in "Specification of the Controlled Load Quality of Service", <a href="#RFC2211" class="xref">[RFC2211]</a>, "Specification of Guaranteed Quality of Service", <a href="#RFC2212" class="xref">[RFC2212]</a>, and "Ethernet Traffic Parameters", <a href="#RFC6003" class="xref">[RFC6003]</a>. Additional service definitions are expected in future documents to support the full range of DetNet services.  In all cases, the existing label-based marking mechanisms defined for TE-LSPs and even E-LSPs are use to support the identification of flows requiring DetNet QoS.  </p>
<p id="rfc.section.6.9.2.p.4">Packets that are marked with a DetNet Class of Service value, but that have not been the subject of a completed reservation, can disrupt the QoS offered to properly reserved DetNet flows by using resources allocated to the reserved flows.  Therefore, the network nodes of a DetNet network: </p>

<ul>
<li>MUST defend the DetNet QoS by discarding or remarking (to a non-DetNet CoS) packets received that are not the subject of a completed reservation.  </li>
<li>MUST NOT use a DetNet reserved resource, e.g. a queue or shaper reserved for DetNet flows, for any packet that does not carry a DetNet Class of Service marker.  </li>
</ul>

<p> </p>
<h1 id="rfc.section.6.9.3">
<a href="#rfc.section.6.9.3">6.9.3.</a> <a href="#Aggregation" id="Aggregation">Cross-DetNet flow resource aggregation</a>
</h1>
<p id="rfc.section.6.9.3.p.1">[Editor's NOTE: keep and extend this section.] </p>
<p id="rfc.section.6.9.3.p.2">The ability to aggregate individual flows, and their associated resource control, into a larger aggregate is an important technique for improving scaling of control in the data, management and control planes.  This document identifies the traffic identification related aspects of aggregation of DetNet flows.  The resource control and management aspects of aggregation (including the queuing/shaping/policing implications) will be covered in other documents.  The data plane implications of aggregation are independent for PW/MPLS and IP encapsulated DetNet flows.  </p>
<p id="rfc.section.6.9.3.p.3">DetNet flows transported via MPLS can leverage MPLS-TE's existing support for hierarchical LSPs (H-LSPs), see <a href="#RFC4206" class="xref">[RFC4206]</a>.  H-LSPs are typically used to aggregate control and resources, they may also be used to provide OAM or protection for the aggregated LSPs.  Arbitrary levels of aggregation naturally falls out of the definition for hierarchy and the MPLS label stack <a href="#RFC3032" class="xref">[RFC3032]</a>.  DetNet nodes which support aggregation (LSP hierarchy) map one or more LSPs (labels) into and from an H-LSP.  Both carried LSPs and H-LSPs may or may not use the TC field, i.e., L-LSPs or E-LSPs.  Such nodes will need to ensure that traffic from aggregated LSPs are placed (shaped/policed/enqueued) onto the H-LSPs in a fashion that ensures the required DetNet service is preserved.  </p>
<p id="rfc.section.6.9.3.p.4">DetNet flows transported via IP have more limited aggregation options, due to the available traffic flow identification fields of the IP solution.  One available approach is to manage the resources associated with a DSCP identified traffic class and to map (remark) individually controlled DetNet flows onto that traffic class.  This approach also requires that nodes support aggregation ensure that traffic from aggregated LSPs are placed (shaped/policed/enqueued) in a fashion that ensures the required DetNet service is preserved.  </p>
<p id="rfc.section.6.9.3.p.5">In both the MPLS and IP cases, additional details of the traffic control capabilities needed at a DetNet-aware node may be covered in the new service descriptions mentioned above or in separate future documents.  Management and control plane mechanisms will also need to ensure that the service required on the aggregate flow (H-LSP or DSCP) are provided, which may include the  discarding or remarking mentioned in the previous sections.  </p>
<h1 id="rfc.section.6.9.4">
<a href="#rfc.section.6.9.4">6.9.4.</a> Layer 2 addressing and QoS Considerations</h1>
<p id="rfc.section.6.9.4.p.1">[Editor's NOTE: review and simplify this section.] </p>
<p id="rfc.section.6.9.4.p.2">The Time-Sensitive Networking (TSN) Task Group of the IEEE 802.1 Working Group have defined (and are defining) a number of amendments to <a href="#IEEE8021Q" class="xref">IEEE 802.1Q</a> that provide zero congestion loss and bounded latency in bridged networks.  <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> defines packet replication and elimination functions that should prove both compatible with and useful to, DetNet networks.  </p>
<p id="rfc.section.6.9.4.p.3">As is the case for DetNet, a Layer 2 network node such as a bridge may need to identify the specific DetNet flow to which a packet belongs in order to provide the TSN/DetNet QoS for that packet.  It also will likely need a CoS marking, such as the priority field of an IEEE Std 802.1Q VLAN tag, to give the packet proper service.  </p>
<p id="rfc.section.6.9.4.p.4">Although the flow identification methods described in <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> are flexible, and in fact, include IP 5-tuple identification methods, the baseline TSN standards assume that every Ethernet frame belonging to a TSN stream (i.e. DetNet flow) carries a multicast destination MAC address that is unique to that flow within the bridged network over which it is carried.  Furthermore, <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> describes three methods by which a packet sequence number can be encoded in an Ethernet frame.  </p>
<p id="rfc.section.6.9.4.p.5">Ensuring that the proper Ethernet VLAN tag priority and destination MAC address are used on a DetNet/TSN packet may require further clarification of the customary L2/L3 transformations carried out by routers and edge label switches.  Edge nodes may also have to move sequence number fields among Layer 2, PW, and IPv6 encapsulations.  </p>
<h1 id="rfc.section.6.9.5">
<a href="#rfc.section.6.9.5">6.9.5.</a> Time Synchronization</h1>
<p id="rfc.section.6.9.5.p.1">[Editor's Note: A detailed discussion of time synchronization is outside the scope of this document, and the production of a specialist text discussing this topic is encouraged. This section will be updated/removed if such a document is available before publication of this text.] </p>
<p id="rfc.section.6.9.5.p.2">Time synchronization is important both from the perspective of operating the DetNet network itself and from the perspective of transferring time across the network between client applications.  Some clients may be able to use the DetNet as their provider of time and frequency, others may require the DetNet to transfer time between a client clock source and a client clock user.  </p>
<p id="rfc.section.6.9.5.p.3">For example, <a href="#RFC8169" class="xref">[RFC8169]</a> describes a method of recording the packet queuing time in an MPLS LSR on a packet by per packet basis and forwarding this information to the egress edge system.  This allows compensation for any variable packet queuing delay to be applied at the packet receiver. Other mechanisms for IP/MPLS networks are defined based on IEEE Standard 1588 <a href="#IEEE1588" class="xref">[IEEE1588]</a>, such as ITU-T <a href="#G.8275.1" class="xref">[G.8275.1]</a> and <a href="#G.8275.2" class="xref">[G.8275.2]</a>.  </p>
<p id="rfc.section.6.9.5.p.4">A more detailed discussion of time synchronization is outside the scope of this document.  </p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> Management and control considerations</h1>
<p id="rfc.section.7.p.1">[Editor's note: This section needs to be different for MPLS and IP solutions. Most solutions are technology dependant. Currently most text in this section is just a draft and may have bits that are already moved to other places/documents.] </p>
<p id="rfc.section.7.p.2">While management plane and control planes are traditionally considered separately, from the Data Plane perspective there is no practical difference based on the origin of flow provisioning information.  This document therefore does not distinguish between information provided by a control plane protocol, e.g., RSVP-TE <a href="#RFC3209" class="xref">[RFC3209]</a> and <a href="#RFC3473" class="xref">[RFC3473]</a>, or by a network management mechanisms, e.g., RestConf <a href="#RFC8040" class="xref">[RFC8040]</a> and YANG <a href="#RFC7950" class="xref">[RFC7950]</a>.  </p>
<p id="rfc.section.7.p.3">[Editor's note: This section is a work in progress.  discuss here what kind of enhancements are needed for DetNet and specifically for PREOF and DetNet zero congest loss and latency control. Need to cover both traffic control (queuing) and connection control (control plane).] </p>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> MPLS-based data plane</h1>
<h1 id="rfc.section.7.1.1">
<a href="#rfc.section.7.1.1">7.1.1.</a> S-Label assignment and distribution</h1>
<p id="rfc.section.7.1.1.p.1">[Editor's note: Outdated and needs more work.] </p>
<p id="rfc.section.7.1.1.p.2">The DetNet S-Label distribution follows the same mechanisms specified for XYZ . The details of the control plane protocol solution required for the label distribution and the management of the label number space are out of scope of this document.  </p>
<h1 id="rfc.section.7.1.2">
<a href="#rfc.section.7.1.2">7.1.2.</a> Explicit routes</h1>
<p id="rfc.section.7.1.2.p.1">It is necessary to consider explicit routes both at the DetNet layer and in the MPLS layer.  In the DetNet layer the explicit route consists of the set of Relay Nodes that the DetNet flow must traverse. In the MPLS layer the explicit route consists of the set of LSRs, links, and possibly link bundle members and queues that the DetNet packets of a flow must traverse between nodes in the DetNet layer (i.e. between a specific Edge Node and the next hop Relay Node, between specific Relay Nodes, and between a specific Relay node and the egress Edge Node. This detailed steering is needed to ensure that packets are routed through the resources that have been reserved for them, and hence provide the DetNet application with the required performance.  </p>
<p id="rfc.section.7.1.2.p.2">Whether configuring, calculating and instantiating this is a multi-stage process, or a single stage process is out of scope of this document.  </p>
<p id="rfc.section.7.1.2.p.3">The one method of explicitly setting up the explicit path at the DetNet layer is through the use of the management controller.  </p>
<p id="rfc.section.7.1.2.p.4">[Editor's note: a method of setting up a graph through the DetNet Nodes using the IGP has been proposed. A reference is needed to e.g., RFC 7813 IS-IS Path Control and Reservation.] </p>
<p id="rfc.section.7.1.2.p.5">There are a number of approaches that can be taken to provide explicit routes/paths in the MPLS layer: </p>

<ul>
<li>The path can be explicitly set up by the management controller calculating the path and explicitly configuring each node along that path.  </li>
<li>The LSP can be set up using RSVP-TE. Such an approach confines the packet to the explicit path.  </li>
<li>The path can be implemented using segment routing.  </li>
</ul>

<p> </p>
<p id="rfc.section.7.1.2.p.6">Where the DetNet traffic is carried over IP <a href="#detnet-data-plane-encapsulation-for-ip-transport-networks" class="xref">Section 11</a> explicit paths may need to be provided in the IP layer. This is for further study.  </p>
<h1 id="rfc.section.7.2">
<a href="#rfc.section.7.2">7.2.</a> Packet replication and elimination</h1>
<p id="rfc.section.7.2.p.1">[Editor's note: Outdated and at the functional level technology independent.. but needs more work.] </p>
<p id="rfc.section.7.2.p.2">The control plane protocol solution required for managing the PREOF processing is outside the scope of this document.  </p>
<h1 id="rfc.section.7.3">
<a href="#rfc.section.7.3">7.3.</a> Congestion protection and latency control</h1>
<p id="rfc.section.7.3.p.1">[Editor's note: TBD] </p>
<h1 id="rfc.section.7.4">
<a href="#rfc.section.7.4">7.4.</a> Bidirectional traffic</h1>
<p id="rfc.section.7.4.p.1">[Editor's NOTE: this section needs to be updated to have its scope limited to management and control.] </p>
<p id="rfc.section.7.4.p.2">Some DetNet applications generate bidirectional traffic.  Using MPLS definitions <a href="#RFC5654" class="xref">[RFC5654]</a> there are associated bidirectional flows, and co-routed bidirectional flows.  MPLS defines a point-to-point associated bidirectional LSP as consisting of two unidirectional point-to-point LSPs, one from A to B and the other from B to A, which are regarded as providing a single logical bidirectional transport path.  This would be analogous of standard IP routing, or PWs running over two reciprocal unidirection LSPs.  MPLS defines a point-to-point co-routed bidirectional LSP as an associated bidirectional LSP which satisfies the additional constraint that its two unidirectional component LSPs follow the same path (in terms of both nodes and links) in both directions.  An important property of co-routed bidirectional LSPs is that their unidirectional component LSPs share fate.  In both types of bidirectional LSPs, resource allocations may differ in each direction.  The concepts of associated bidirectional flows  and co-routed bidirectional flows can be applied to DetNet flows as well whether IPv6 or MPLS is used.  </p>
<p id="rfc.section.7.4.p.3">While the IPv6 and MPLS data planes must support bidirectional DetNet flows, there are no special bidirectional features with respect to the data plane other than need for the two directions take the same paths.  Fate sharing and associated vs co-routed bidirectional flows can be managed at the control level.  Note, that there is no stated requirement for bidirectional DetNet flows to be supported using the same IPv6 Flow Labels or MPLS Labels in each direction.  Control mechanisms will need to support such bidirectional flows for both IPv6 and MPLS, but such mechanisms are out of scope of this document.  An example control plane solution for MPLS can be found in <a href="#RFC7551" class="xref">[RFC7551]</a>.  </p>
<h1 id="rfc.section.7.5">
<a href="#rfc.section.7.5">7.5.</a> Flow aggregation control</h1>
<p id="rfc.section.7.5.p.1">[TBD] </p>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#ip-over-detnet" id="ip-over-detnet">DetNet IP Operation over DetNet MPLS Service</a>
</h1>
<p id="rfc.section.8.p.1">[Editor's note: this is a place holder section.  A standalone section on operation of IP flows over DetNet MPLS data plane.  Includes RFC2119 Language.] </p>
<h1 id="rfc.section.9">
<a href="#rfc.section.9">9.</a> <a href="#tsn-over-detnet" id="tsn-over-detnet">IEEE 802.1 TSN Interconnection over DetNet MPLS Service</a>
</h1>
<p id="rfc.section.9.p.1">[Editor's note: this is a place holder section.  A standalone section on TSN "island" interconnect over DetNet".  Includes RFC2119 Language.] </p>
<h1 id="rfc.section.10">
<a href="#rfc.section.10">10.</a> <a href="#mpls-over-tsn" id="mpls-over-tsn">DetNet MPLS Transport Layer Operation over IEEE 802.1 TSN Sub-Networks</a>
</h1>
<p id="rfc.section.10.p.1">[Editor's note: this is a place holder section.  A standalone section on MPLS over IEEE 802.1 TSN.  Includes RFC2119 Language.] </p>
<p id="rfc.section.10.p.2">This section covers how MPLS DetNet flows operate over an IEEE 802.1 TSN sub-network.  <a href="#fig_mpls_detnet_to_tsn" class="xref">Figure 17</a> illustrates such a scenario, where two MPLS (DetNet) nodes are interconnected by a TSN sub-network. Node-1 is single homed and Node-2 is dual-homed.  MPLS nodes can be (1) MPLS DetNet End System, (2) MPLS DetNet Edge or Relay node or (3) MPLS Transit node.  </p>
<p id="rfc.section.10.p.3">Note: in case of MPLS Transit node there is no DetNet Service sub-layer.</p>
<div id="rfc.figure.17"></div>
<div id="fig_mpls_detnet_to_tsn"></div>
<pre>
   MPLS (DetNet)                MPLS (DetNet)
      Node-1                       Node-2 

   +---------+                  +---------+
&lt;--| Service*|-- DetNet flow ---| Service*|--&gt;
   +---------+                  +---------+
   |Transport|                  |Transport|
   +-------.-+    &lt;-TSN Str-&gt;   +-.-----.-+
            \      ,-------.     /     /
             +----[ TSN-Sub ]---+     / 
                  [ Network ]--------+      
                   `-------'            
&lt;---------------- DetNet MPLS ---------------&gt;

Note: * no service sub-layer for transit nodes
</pre>
<p class="figure">Figure 17: DetNet Enabled MPLS Network over a TSN sub-network</p>
<p id="rfc.section.10.p.4">The Time-Sensitive Networking (TSN) Task Group of the IEEE 802.1 Working Group have defined (and are defining) a number of amendments to <a href="#IEEE8021Q" class="xref">IEEE 802.1Q</a> that provide zero congestion loss and bounded latency in bridged networks. Furthermore <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> defines frame replication and elimination functions for reliability that should prove both compatible with and useful to, DetNet networks.  All these functions have to identify flows those require TSN treatment.  </p>
<p id="rfc.section.10.p.5">As is the case for DetNet, a Layer 2 network node such as a bridge may need to identify the specific DetNet flow to which a packet belongs in order to provide the TSN/DetNet QoS for that packet.  It also may need a CoS marking, such as the priority field of an IEEE Std 802.1Q VLAN tag, to give the packet proper service.  </p>
<p id="rfc.section.10.p.6">The challange for MPLS DeNet flows is that the protocol interworking function defined in <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a> works only for IP flows. The aim of the protocol interworking function is to convert an ingress flow to use a specific multicast destination MAC address and VLAN, for example to direct the packets through a specific path inside the bridged network. A similar interworking pair at the other end of the TSN sub-network would restore the packet to its original destination MAC address and VLAN.  </p>
<p id="rfc.section.10.p.7">As protocol interworking function defined in <a href="#IEEE8021CB" class="xref">[IEEE8021CB]</a> does not work for MPLS labeled flows, the MPLS DetNet nodes MUST ensure proper TSN sub-network specific Ethernet encapsulation of the MPLS DetNet packets. For a given TSN Stream (i.e., DetNet flow) an MPLS (DetNet) node MUST behave as a TSN-aware Talker or a Listener inside the TSN sub-network.  </p>
<h1 id="rfc.section.10.1">
<a href="#rfc.section.10.1">10.1.</a> Mapping of TSN Stream ID and Sequence Number</h1>
<p id="rfc.section.10.1.p.1">TSN capable MPLS (DetNet) nodes are TSN-aware Talker/Listener as shown in <a href="#fig_mpls_with_tsn" class="xref">Figure 18</a>.  MPLS (DetNet) node MUST provide the TSN sub-network specific Ethernet encapsulation over the link(s) towards the sub-network. An TSN-aware MPLS (DetNet) node MUST support the following TSN components: </p>

<ol>
<li>For recognizing flows: <ul><li>Stream Identification (MPLS-flow-aware)</li></ul>
<p> </p>
</li>
<li>For FRER used inside the TSN domain, additonaly: <ul>
<li>Sequencing function (MPLS-flow-aware)</li>
<li>Sequence encode/decode function</li>
</ul>
<p> </p>
</li>
<li>For FRER when the node is a TSN replication or elimination point, additionally: <ul>
<li>Stream splitting function</li>
<li>Individual recovery function</li>
</ul>
<p> </p>
</li>
</ol>

<p> </p>
<p id="rfc.section.10.1.p.2">[Editor's note: Should we added here requirements regarding IEEE 802.1Q C-VLAN component?] </p>
<p id="rfc.section.10.1.p.3">The Stream Identification and The Sequencing functions are slightly modified for frames passed down the protocol stack from the upper layers.  </p>
<p id="rfc.section.10.1.p.4">Stream Identification MUST pair MPLS flows and TSN Streams and encode that in data plane formats as well.  The packet's stream_handle subparameter (see <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a>) inside the Talker/Listener is defined based on the Flow-ID used in the upper MPLS DetNet layer.  Stream Identification function MUST encode Ethernet header fields namely (1) the destination MAC-address, (2) the VLAN-ID and (3) priority parameters with TSN sub-network specific values. Encoding is provided for the frame passed down the stack from the upper layers.  </p>
<p id="rfc.section.10.1.p.5">The sequence generation function resides in the Sequencing function. It generates a sequence_number subparameter for each packet of a Stream passed down to the lower layers.  Sequencing function MUST copy sequence information from the MPLS d-CW of the packet to the sequence_number subparameter for the frame passed down the stack from the upper layers.  </p>
<div id="rfc.figure.18"></div>
<div id="fig_mpls_with_tsn"></div>
<pre>
   MPLS (DetNet)
      Node-1
   &lt;---------&gt; 
   
   +---------+
&lt;--| Service |-- DetNet flow ------------------
   +---------+
   |Transport|
   +---------+    +---------------+  
   | L2 with |&lt;---| L2 Relay with |---- TSN ----
   |   TSN   |    | TSN function  |    Stream
   +----.----+    +--.---------.--+
         \__________/           \______
		 
   TSN-aware        
    Talker /          TSN-Bridge
    Listener             Relay

    	&lt;--------- TSN sub-network ------------
</pre>
<p class="figure">Figure 18: MPLS (DetNet) node with TSN functions</p>
<p id="rfc.section.10.1.p.6">The Sequence encode/decode function MUST support the Redundancy tag (R-TAG) format as per Clause 7.8 of <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a>.  </p>
<h1 id="rfc.section.10.2">
<a href="#rfc.section.10.2">10.2.</a> TSN Usage of FRER</h1>
<p id="rfc.section.10.2.p.1">TSN Streams supporting DetNet flows may use Frame Replication and Elimination for Redundancy (FRER) [802.1CB] based on the loss service requirements of the TSN Stream, which is derived from the DetNet service requirements of the DetNet mapped flow.  The specific operation of FRER is not modified by the use of DetNet and follows  <a href="#IEEE8021CB" class="xref">IEEE 802.1CB</a>.  </p>
<p id="rfc.section.10.2.p.2">FRER function and the provided service recovery is available only within the TSN sub-network however as the Stream-ID and the TSN sequence number are paired with the MPLS flow parameters they can be combined with PREOF functions.  </p>
<h1 id="rfc.section.10.3">
<a href="#rfc.section.10.3">10.3.</a> Management and Control Implications</h1>
<p id="rfc.section.10.3.p.1">[Editor's note: This section is TBD Covers Creation, mapping, removal of TSN Stream IDs, related parameters and,when needed, configuration of FRER. Supported by management/control plane.] </p>
<h1 id="rfc.section.11">
<a href="#rfc.section.11">11.</a> <a href="#detnet-data-plane-encapsulation-for-ip-transport-networks" id="detnet-data-plane-encapsulation-for-ip-transport-networks">DetNet MPLS Transport Layer Operation over IP DetNet PSNs</a>
</h1>
<p id="rfc.section.11.p.1">This section specifies the DetNet encapsulation over an IP transport network.  The approach is modeled on the operation of MPLS and PseudoWires (PW) over an IP Packet Switched Network (PSN) <a href="#RFC3985" class="xref">[RFC3985]</a><a href="#RFC4385" class="xref">[RFC4385]</a><a href="#RFC7510" class="xref">[RFC7510]</a>.  It is also based on the MPLS data plane encapsulation described in <a href="#pwSolution" class="xref">Section 6.2</a>.  </p>
<p id="rfc.section.11.p.2">To carry DetNet with full functionality at the DetNet layer over an IP transport network, the following components are required (these are a subset of the requirements for MPLS encapsulation listed in <a href="#dn-MPLS-en-comps" class="xref">Section 6.1</a>): </p>
<p></p>

<ol>
<li>A method of identifying the DetNet flow group to the processing element.</li>
<li>A method of carrying the DetNet sequence number.</li>
<li>A method of distinguishing DetNet OAM packets from DetNet data packets.</li>
<li>A method of carrying queuing and forwarding indication.</li>
</ol>

<p> </p>
<p id="rfc.section.11.p.4">These requirements are satisfied by the DetNet over MPLS Encapsulation described in <a href="#pwSolution" class="xref">Section 6.2</a>.  </p>
<p id="rfc.section.11.p.5">To simplify operations and implementations, rather than inventing a new encapsulation, the IP encapsulation takes advantage of the MPLS encapsulation.  By using the specification of MPLS over UDP and IP in <a href="#RFC7510" class="xref">[RFC7510]</a>, the T-Label(s) shown in <a href="#fig_pw_mpls" class="xref">Figure 15</a> in <a href="#pwSolution" class="xref">Section 6.2</a> can be replaced by UDP and IP, resulting in the following encapsulation: </p>
<div id="rfc.figure.19"></div>
<div id="IP-encap-dn"></div>
<pre>
+---------------------------------+
|                                 |
|           DetNet Flow           |
|         Payload  Packet         |
|                                 |
+---------------------------------+ &lt;--\
|       DetNet Control Word       |    |
+---------------------------------+    +--&gt; DetNet data plane
|             S-Label             |    |    MPLS encapsulation
+---------------------------------+ &lt;--/
|           UDP Header            |
+---------------------------------+
|           IP Header             |
+---------------------------------+
|           Data-Link             |
+---------------------------------+
|           Physical              |
+---------------------------------+

 </pre>
<p class="figure">Figure 19: IP Encapsulation of DetNet</p>
<p id="rfc.section.11.p.6">Where the UDP header is used as defined in Section 3 of <a href="#RFC7510" class="xref">[RFC7510]</a>.  </p>
<p id="rfc.section.11.p.7">As in <a href="#pwSolution" class="xref">Section 6.2</a>, the S-Label is used to identify a DetNet flow to the peer node that processes it, in this case the node addressed by the IP Header in <a href="#IP-encap-dn" class="xref">Figure 19</a>. The S-Label is allocated from the receiving node?s platform label space <a href="#RFC3031" class="xref">[RFC3031]</a>.  </p>
<p id="rfc.section.11.p.8">In ingress Edge Nodes, the encapsulation in <a href="#IP-encap-dn" class="xref">Figure 19</a> will be imposed on Detnet Flow Payload Packets as received from DetNet End Systems, and the encapsulation will be removed in egress Edge Nodes as they transmit the Payload Packets to the End Systems.  </p>
<p id="rfc.section.11.p.9">Note that this encapsulation works equally well with IPv4 and IPv6.  </p>
<p id="rfc.section.11.p.10">This encapsulation can also be used in conjunction with segment routing as specified in <a href="#I-D.ietf-spring-segment-routing-mpls" class="xref">[I-D.ietf-spring-segment-routing-mpls]</a>. In this case, the T-Label(s) in <a href="#IP-encap-dn" class="xref">Figure 19</a> should be retained, and at each hop, the top T-label is popped and mapped to a corresponding UDP/IP tunnel, resulting in the following encapsulation: </p>
<div id="rfc.figure.20"></div>
<div id="IP-encap-dn-sr"></div>
<pre>
  +---------------------------------+
  |                                 |
  |           DetNet Flow           |
  |         Payload  Packet         |
  |                                 |
  +---------------------------------+ &lt;--\
  |       DetNet Control Word       |    |
  +---------------------------------+    +--&gt; DetNet data plane
  |           S-Label               |    |    MPLS encapsulation
  +---------------------------------+ &lt;--/
  |           T-Label(s)            |
  +---------------------------------+
  |           UDP Header            |
  +---------------------------------+
  |           IP Header             |
  +---------------------------------+
  |           Data-Link             |
  +---------------------------------+
  |           Physical              |
  +---------------------------------+

 </pre>
<p class="figure">Figure 20: IP Encapsulation of DetNet with MPLS-SR</p>
<p id="rfc.section.11.p.11">Again, the UDP header is used as defined in Section 3 of <a href="#RFC7510" class="xref">[RFC7510]</a>.  </p>
<p id="rfc.section.11.p.12">Note that if required in both the case of IP Encapsulation of DetNet <a href="#IP-encap-dn" class="xref">Figure 19</a>, and of IP Encapsulation of DetNet with MPLS-SR <a href="#IP-encap-dn-sr" class="xref">Figure 20</a>, it is possible to omit the UDP header if required. Operation of MPLS directly over IP is described in <a href="#RFC4023" class="xref">[RFC4023]</a>.  In this case DetNet Service can be provided on a per IP flow basis as described in <a href="#I-D.ietf-detnet-dp-sol-ip" class="xref">[I-D.ietf-detnet-dp-sol-ip]</a>.  </p>
<h1 id="rfc.section.12">
<a href="#rfc.section.12">12.</a> Security considerations</h1>
<p id="rfc.section.12.p.1">The security considerations of DetNet in general are discussed in <a href="#I-D.ietf-detnet-architecture" class="xref">[I-D.ietf-detnet-architecture]</a> and <a href="#I-D.sdt-detnet-security" class="xref">[I-D.sdt-detnet-security]</a>. Other security considerations will be added in a future version of this draft.  </p>
<h1 id="rfc.section.13">
<a href="#rfc.section.13">13.</a> <a href="#iana" id="iana">IANA considerations</a>
</h1>
<p id="rfc.section.13.p.1">This document makes no IANA requests.  </p>
<h1 id="rfc.section.14">
<a href="#rfc.section.14">14.</a> <a href="#contributors" id="contributors">Contributors</a>
</h1>
<p id="rfc.section.14.p.1">RFC7322 limits the number of authors listed on the front page of a draft to a maximum of 5, far fewer than the 20 individuals below who made important contributions to this draft. The editor wishes to thank and acknowledge each of the following authors for contributing text to this draft. See also <a href="#acks" class="xref">Section 15</a>.  </p>
<pre>
   Loa Andersson
   Huawei
   Email: loa@pi.nu

   Yuanlong Jiang
   Huawei
   Email: jiangyuanlong@huawei.com

   Norman Finn
   Huawei
   3101 Rio Way
   Spring Valley, CA  91977
   USA
   Email: norman.finn@mail01.huawei.com

   Janos Farkas
   Ericsson
   Magyar Tudosok krt. 11.
   Budapest  1117
   Hungary
   Email: janos.farkas@ericsson.com

   Carlos J. Bernardos
   Universidad Carlos III de Madrid
   Av. Universidad, 30
   Leganes, Madrid  28911
   Spain
   Email: cjbc@it.uc3m.es

   Tal Mizrahi
   Marvell
   6 Hamada st.
   Yokneam
   Israel
   Email: talmi@marvell.com

   Lou Berger
   LabN Consulting, L.L.C.
   Email: lberger@labn.net

   Stewart Bryant
   Huawei Technologies
   Email: stewart.bryant@gmail.com
  
   Mach Chen
   Huawei Technologies
   Email: mach.chen@huawei.com
   </pre>
<h1 id="rfc.section.15">
<a href="#rfc.section.15">15.</a> <a href="#acks" id="acks">Acknowledgements</a>
</h1>
<p id="rfc.section.15.p.1">The author(s) ACK and NACK.  </p>
<p id="rfc.section.15.p.2">The following people were part of the DetNet Data Plane Solution Design Team: </p>

<ul class="empty">
<li>Jouni Korhonen</li>
<li>J&#225;nos Farkas</li>
<li>Norman Finn</li>
<li>Bal&#225;zs Varga</li>
<li>Loa Andersson</li>
<li>Tal Mizrahi</li>
<li>David Mozes</li>
<li>Yuanlong Jiang</li>
<li>Carlos J. Bernardos</li>
</ul>
<p id="rfc.section.15.p.3">The DetNet chairs serving during the DetNet Data Plane Solution Design Team: </p>

<ul class="empty">
<li>Lou Berger</li>
<li>Pat Thaler</li>
</ul>
<p id="rfc.section.15.p.4">Thanks for Stewart Bryant for his extensive review of the previous versions of the document.  </p>
<h1 id="rfc.references">
<a href="#rfc.references">16.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">16.1.</a> Normative references</h1>
<table><tbody>
<tr>
<td class="reference"><b id="I-D.ietf-spring-segment-routing-mpls">[I-D.ietf-spring-segment-routing-mpls]</b></td>
<td class="top">
<a>Bashandy, A.</a>, <a>Filsfils, C.</a>, <a>Previdi, S.</a>, <a>Decraene, B.</a>, <a>Litkowski, S.</a> and <a>R. Shakir</a>, "<a href="https://tools.ietf.org/html/draft-ietf-spring-segment-routing-mpls-14">Segment Routing with MPLS data plane</a>", Internet-Draft draft-ietf-spring-segment-routing-mpls-14, June 2018.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2211">[RFC2211]</b></td>
<td class="top">
<a>Wroclawski, J.</a>, "<a href="https://tools.ietf.org/html/rfc2211">Specification of the Controlled-Load Network Element Service</a>", RFC 2211, DOI 10.17487/RFC2211, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2212">[RFC2212]</b></td>
<td class="top">
<a>Shenker, S.</a>, <a>Partridge, C.</a> and <a>R. Guerin</a>, "<a href="https://tools.ietf.org/html/rfc2212">Specification of Guaranteed Quality of Service</a>", RFC 2212, DOI 10.17487/RFC2212, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2474">[RFC2474]</b></td>
<td class="top">
<a>Nichols, K.</a>, <a>Blake, S.</a>, <a>Baker, F.</a> and <a>D. Black</a>, "<a href="https://tools.ietf.org/html/rfc2474">Definition of the Differentiated Services Field (DS Field) in the IPv4 and IPv6 Headers</a>", RFC 2474, DOI 10.17487/RFC2474, December 1998.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3031">[RFC3031]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Viswanathan, A.</a> and <a>R. Callon</a>, "<a href="https://tools.ietf.org/html/rfc3031">Multiprotocol Label Switching Architecture</a>", RFC 3031, DOI 10.17487/RFC3031, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3032">[RFC3032]</b></td>
<td class="top">
<a>Rosen, E.</a>, <a>Tappan, D.</a>, <a>Fedorkow, G.</a>, <a>Rekhter, Y.</a>, <a>Farinacci, D.</a>, <a>Li, T.</a> and <a>A. Conta</a>, "<a href="https://tools.ietf.org/html/rfc3032">MPLS Label Stack Encoding</a>", RFC 3032, DOI 10.17487/RFC3032, January 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3168">[RFC3168]</b></td>
<td class="top">
<a>Ramakrishnan, K.</a>, <a>Floyd, S.</a> and <a>D. Black</a>, "<a href="https://tools.ietf.org/html/rfc3168">The Addition of Explicit Congestion Notification (ECN) to IP</a>", RFC 3168, DOI 10.17487/RFC3168, September 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3209">[RFC3209]</b></td>
<td class="top">
<a>Awduche, D.</a>, <a>Berger, L.</a>, <a>Gan, D.</a>, <a>Li, T.</a>, <a>Srinivasan, V.</a> and <a>G. Swallow</a>, "<a href="https://tools.ietf.org/html/rfc3209">RSVP-TE: Extensions to RSVP for LSP Tunnels</a>", RFC 3209, DOI 10.17487/RFC3209, December 2001.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3270">[RFC3270]</b></td>
<td class="top">
<a>Le Faucheur, F.</a>, <a>Wu, L.</a>, <a>Davie, B.</a>, <a>Davari, S.</a>, <a>Vaananen, P.</a>, <a>Krishnan, R.</a>, <a>Cheval, P.</a> and <a>J. Heinanen</a>, "<a href="https://tools.ietf.org/html/rfc3270">Multi-Protocol Label Switching (MPLS) Support of Differentiated Services</a>", RFC 3270, DOI 10.17487/RFC3270, May 2002.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3443">[RFC3443]</b></td>
<td class="top">
<a>Agarwal, P.</a> and <a>B. Akyol</a>, "<a href="https://tools.ietf.org/html/rfc3443">Time To Live (TTL) Processing in Multi-Protocol Label Switching (MPLS) Networks</a>", RFC 3443, DOI 10.17487/RFC3443, January 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3473">[RFC3473]</b></td>
<td class="top">
<a>Berger, L.</a>, "<a href="https://tools.ietf.org/html/rfc3473">Generalized Multi-Protocol Label Switching (GMPLS) Signaling Resource ReserVation Protocol-Traffic Engineering (RSVP-TE) Extensions</a>", RFC 3473, DOI 10.17487/RFC3473, January 2003.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4023">[RFC4023]</b></td>
<td class="top">
<a>Worster, T.</a>, <a>Rekhter, Y.</a> and <a>E. Rosen</a>, "<a href="https://tools.ietf.org/html/rfc4023">Encapsulating MPLS in IP or Generic Routing Encapsulation (GRE)</a>", RFC 4023, DOI 10.17487/RFC4023, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4206">[RFC4206]</b></td>
<td class="top">
<a>Kompella, K.</a> and <a>Y. Rekhter</a>, "<a href="https://tools.ietf.org/html/rfc4206">Label Switched Paths (LSP) Hierarchy with Generalized Multi-Protocol Label Switching (GMPLS) Traffic Engineering (TE)</a>", RFC 4206, DOI 10.17487/RFC4206, October 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4385">[RFC4385]</b></td>
<td class="top">
<a>Bryant, S.</a>, <a>Swallow, G.</a>, <a>Martini, L.</a> and <a>D. McPherson</a>, "<a href="https://tools.ietf.org/html/rfc4385">Pseudowire Emulation Edge-to-Edge (PWE3) Control Word for Use over an MPLS PSN</a>", RFC 4385, DOI 10.17487/RFC4385, February 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5085">[RFC5085]</b></td>
<td class="top">
<a>Nadeau, T.</a> and <a>C. Pignataro</a>, "<a href="https://tools.ietf.org/html/rfc5085">Pseudowire Virtual Circuit Connectivity Verification (VCCV): A Control Channel for Pseudowires</a>", RFC 5085, DOI 10.17487/RFC5085, December 2007.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5129">[RFC5129]</b></td>
<td class="top">
<a>Davie, B.</a>, <a>Briscoe, B.</a> and <a>J. Tay</a>, "<a href="https://tools.ietf.org/html/rfc5129">Explicit Congestion Marking in MPLS</a>", RFC 5129, DOI 10.17487/RFC5129, January 2008.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5462">[RFC5462]</b></td>
<td class="top">
<a>Andersson, L.</a> and <a>R. Asati</a>, "<a href="https://tools.ietf.org/html/rfc5462">Multiprotocol Label Switching (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic Class" Field</a>", RFC 5462, DOI 10.17487/RFC5462, February 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6003">[RFC6003]</b></td>
<td class="top">
<a>Papadimitriou, D.</a>, "<a href="https://tools.ietf.org/html/rfc6003">Ethernet Traffic Parameters</a>", RFC 6003, DOI 10.17487/RFC6003, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7510">[RFC7510]</b></td>
<td class="top">
<a>Xu, X.</a>, <a>Sheth, N.</a>, <a>Yong, L.</a>, <a>Callon, R.</a> and <a>D. Black</a>, "<a href="https://tools.ietf.org/html/rfc7510">Encapsulating MPLS in UDP</a>", RFC 7510, DOI 10.17487/RFC7510, April 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8174">[RFC8174]</b></td>
<td class="top">
<a>Leiba, B.</a>, "<a href="https://tools.ietf.org/html/rfc8174">Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</a>", BCP 14, RFC 8174, DOI 10.17487/RFC8174, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">16.2.</a> Informative references</h1>
<table><tbody>
<tr>
<td class="reference"><b id="G.8275.1">[G.8275.1]</b></td>
<td class="top">
<a>International Telecommunication Union</a>, "<a href="https://www.itu.int/rec/T-REC-G.8275.1/en">Precision time protocol telecom profile for phase/time synchronization with full timing support from the network</a>", ITU-T G.8275.1/Y.1369.1 G.8275.1, June 2016.</td>
</tr>
<tr>
<td class="reference"><b id="G.8275.2">[G.8275.2]</b></td>
<td class="top">
<a>International Telecommunication Union</a>, "<a href="https://www.itu.int/rec/T-REC-G.8275.2/en">Precision time protocol telecom profile for phase/time synchronization with partial timing support from the network</a>", ITU-T G.8275.2/Y.1369.2 G.8275.2, June 2016.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-detnet-architecture">[I-D.ietf-detnet-architecture]</b></td>
<td class="top">
<a>Finn, N.</a>, <a>Thubert, P.</a>, <a>Varga, B.</a> and <a>J. Farkas</a>, "<a href="https://tools.ietf.org/html/draft-ietf-detnet-architecture-08">Deterministic Networking Architecture</a>", Internet-Draft draft-ietf-detnet-architecture-08, September 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-detnet-dp-alt">[I-D.ietf-detnet-dp-alt]</b></td>
<td class="top">
<a>Korhonen, J.</a>, <a>Farkas, J.</a>, <a>Mirsky, G.</a>, <a>Thubert, P.</a>, <a>Zhuangyan, Z.</a> and <a>L. Berger</a>, "<a href="https://tools.ietf.org/html/draft-ietf-detnet-dp-alt-00">DetNet Data Plane Protocol and Solution Alternatives</a>", Internet-Draft draft-ietf-detnet-dp-alt-00, October 2016.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.ietf-detnet-dp-sol-ip">[I-D.ietf-detnet-dp-sol-ip]</b></td>
<td class="top">
<a>Korhonen, J., Varga, B.</a>, "<a>DetNet IP Data Plane Encapsulation</a>", 2018.</td>
</tr>
<tr>
<td class="reference"><b id="I-D.sdt-detnet-security">[I-D.sdt-detnet-security]</b></td>
<td class="top">
<a>Mizrahi, T., Grossman, E., Hacker, A., Das, S.</a>, "<a>Deterministic Networking (DetNet) Security Considerations, draft-sdt-detnet-security, work in progress</a>", 2017.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE1588">[IEEE1588]</b></td>
<td class="top">
<a>IEEE</a>, "<a>IEEE 1588 Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems Version 2</a>", 2008.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE8021CB">[IEEE8021CB]</b></td>
<td class="top">
<a title="IEEE 802.1">Finn, N.</a>, "<a href="http://www.ieee802.org/1/files/private/cb-drafts/d2/802-1CB-d2-1.pdf">Draft Standard for Local and metropolitan area networks - Seamless Redundancy</a>", IEEE P802.1CB /D2.1 P802.1CB, December 2015.</td>
</tr>
<tr>
<td class="reference"><b id="IEEE8021Q">[IEEE8021Q]</b></td>
<td class="top">
<a>IEEE 802.1</a>, "<a href="http://standards.ieee.org/about/get/">Standard for Local and metropolitan area networks--Bridges and Bridged Networks (IEEE Std 802.1Q-2014)</a>", 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2205">[RFC2205]</b></td>
<td class="top">
<a>Braden, R.</a>, <a>Zhang, L.</a>, <a>Berson, S.</a>, <a>Herzog, S.</a> and <a>S. Jamin</a>, "<a href="https://tools.ietf.org/html/rfc2205">Resource ReSerVation Protocol (RSVP) -- Version 1 Functional Specification</a>", RFC 2205, DOI 10.17487/RFC2205, September 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3985">[RFC3985]</b></td>
<td class="top">
<a>Bryant, S.</a> and <a>P. Pate</a>, "<a href="https://tools.ietf.org/html/rfc3985">Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture</a>", RFC 3985, DOI 10.17487/RFC3985, March 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4448">[RFC4448]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Rosen, E.</a>, <a>El-Aawar, N.</a> and <a>G. Heron</a>, "<a href="https://tools.ietf.org/html/rfc4448">Encapsulation Methods for Transport of Ethernet over MPLS Networks</a>", RFC 4448, DOI 10.17487/RFC4448, April 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5654">[RFC5654]</b></td>
<td class="top">
<a>Niven-Jenkins, B.</a>, <a>Brungard, D.</a>, <a>Betts, M.</a>, <a>Sprecher, N.</a> and <a>S. Ueno</a>, "<a href="https://tools.ietf.org/html/rfc5654">Requirements of an MPLS Transport Profile</a>", RFC 5654, DOI 10.17487/RFC5654, September 2009.</td>
</tr>
<tr>
<td class="reference"><b id="RFC5921">[RFC5921]</b></td>
<td class="top">
<a>Bocci, M.</a>, <a>Bryant, S.</a>, <a>Frost, D.</a>, <a>Levrau, L.</a> and <a>L. Berger</a>, "<a href="https://tools.ietf.org/html/rfc5921">A Framework for MPLS in Transport Networks</a>", RFC 5921, DOI 10.17487/RFC5921, July 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6073">[RFC6073]</b></td>
<td class="top">
<a>Martini, L.</a>, <a>Metz, C.</a>, <a>Nadeau, T.</a>, <a>Bocci, M.</a> and <a>M. Aissaoui</a>, "<a href="https://tools.ietf.org/html/rfc6073">Segmented Pseudowire</a>", RFC 6073, DOI 10.17487/RFC6073, January 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7551">[RFC7551]</b></td>
<td class="top">
<a>Zhang, F.</a>, <a>Jing, R.</a> and <a>R. Gandhi</a>, "<a href="https://tools.ietf.org/html/rfc7551">RSVP-TE Extensions for Associated Bidirectional Label Switched Paths (LSPs)</a>", RFC 7551, DOI 10.17487/RFC7551, May 2015.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7950">[RFC7950]</b></td>
<td class="top">
<a>Bjorklund, M.</a>, "<a href="https://tools.ietf.org/html/rfc7950">The YANG 1.1 Data Modeling Language</a>", RFC 7950, DOI 10.17487/RFC7950, August 2016.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8040">[RFC8040]</b></td>
<td class="top">
<a>Bierman, A.</a>, <a>Bjorklund, M.</a> and <a>K. Watsen</a>, "<a href="https://tools.ietf.org/html/rfc8040">RESTCONF Protocol</a>", RFC 8040, DOI 10.17487/RFC8040, January 2017.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8169">[RFC8169]</b></td>
<td class="top">
<a>Mirsky, G.</a>, <a>Ruffini, S.</a>, <a>Gray, E.</a>, <a>Drake, J.</a>, <a>Bryant, S.</a> and <a>A. Vainshtein</a>, "<a href="https://tools.ietf.org/html/rfc8169">Residence Time Measurement in MPLS Networks</a>", RFC 8169, DOI 10.17487/RFC8169, May 2017.</td>
</tr>
</tbody></table>
<h1 id="rfc.appendix.A">
<a href="#rfc.appendix.A">Appendix A.</a> <a href="#sec_comb" id="sec_comb">Example of DetNet data plane operation</a>
</h1>
<p id="rfc.section.A.p.1">[Editor's note: Add a simplified example of DetNet data plane and how labels etc work in the case of MPLS-based PSN and utilizing PREOF. The figure is subject to change depending on the further DT decisions on the label handling..] </p>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Jouni Korhonen</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Korhonen</span>
	  </span>
	</span>
	<span class="org vcardline"></span>
	<span class="adr">
	  
	  <span class="vcardline">
		<span class="locality"></span> 
		<span class="region"></span>
		<span class="code"></span>
	  </span>
	  <span class="country-name vcardline"></span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:jouni.nospam@gmail.com">jouni.nospam@gmail.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Bal&#225;zs Varga</span> (editor)
	  <span class="n hidden">
		<span class="family-name">Varga</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson</span>
	<span class="adr">
	  <span class="vcardline">Magyar Tudosok krt. 11.</span>

	  <span class="vcardline">
		<span class="locality">Budapest</span>,  
		<span class="region"></span>
		<span class="code">1117</span>
	  </span>
	  <span class="country-name vcardline">Hungary</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:balazs.a.varga@ericsson.com">balazs.a.varga@ericsson.com</a></span>

  </address>
</div>

</body>
</html>
